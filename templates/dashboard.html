<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Service Business - Admin Panel</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #0f172a;
            --secondary: #1e293b;
            --accent: #f59e0b;
            --accent-light: #fbbf24;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --bg-dark: #0a0f1a;
            --bg-card: #111827;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --border: #1e293b;
            --gradient-1: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            --gradient-2: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Animated Background */
        .bg-pattern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(245, 158, 11, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(59, 130, 246, 0.05) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(15, 23, 42, 0.9) 0%, var(--bg-dark) 100%);
            pointer-events: none;
            z-index: 0;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 280px;
            height: 100vh;
            background: var(--bg-card);
            border-right: 1px solid var(--border);
            padding: 24px;
            z-index: 100;
            display: flex;
            flex-direction: column;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 24px;
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background: var(--gradient-1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 20px;
            color: var(--primary);
        }

        .logo-text {
            font-weight: 700;
            font-size: 18px;
            line-height: 1.2;
        }

        .logo-text span {
            display: block;
            font-size: 12px;
            font-weight: 400;
            color: var(--text-secondary);
        }

        .nav-menu {
            list-style: none;
            flex: 1;
        }

        .nav-item {
            margin-bottom: 4px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 16px;
            border-radius: 10px;
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .nav-link:hover {
            background: var(--secondary);
            color: var(--text-primary);
        }

        .nav-link.active {
            background: var(--gradient-1);
            color: var(--primary);
        }

        .nav-link svg {
            width: 20px;
            height: 20px;
        }

        .nav-badge {
            margin-left: auto;
            background: var(--accent);
            color: var(--primary);
            font-size: 11px;
            font-weight: 700;
            padding: 2px 8px;
            border-radius: 20px;
        }

        /* Main Content */
        .main-content {
            margin-left: 280px;
            padding: 24px 32px;
            position: relative;
            z-index: 1;
            min-height: 100vh;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }

        .page-title {
            font-size: 28px;
            font-weight: 700;
        }

        .page-title span {
            color: var(--accent);
        }

        .header-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 12px 16px 12px 44px;
            color: var(--text-primary);
            font-size: 14px;
            width: 280px;
            transition: all 0.3s ease;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
        }

        .search-box svg {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            width: 18px;
            height: 18px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            font-family: inherit;
        }

        .btn-primary {
            background: var(--gradient-1);
            color: var(--primary);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(245, 158, 11, 0.3);
        }

        .btn-secondary {
            background: var(--secondary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            border-color: var(--accent);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            border-color: var(--accent);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, rgba(245, 158, 11, 0.1) 0%, transparent 70%);
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
        }

        .stat-icon.blue { background: rgba(59, 130, 246, 0.15); color: #3b82f6; }
        .stat-icon.green { background: rgba(16, 185, 129, 0.15); color: #10b981; }
        .stat-icon.orange { background: rgba(245, 158, 11, 0.15); color: #f59e0b; }
        .stat-icon.purple { background: rgba(139, 92, 246, 0.15); color: #8b5cf6; }

        .stat-value {
            font-size: 32px;
            font-weight: 800;
            font-family: 'Space Mono', monospace;
            margin-bottom: 4px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* Content Area */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Form Styles */
        .form-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 32px;
            margin-bottom: 24px;
        }

        .form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 28px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }

        .form-title {
            font-size: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .form-title-icon {
            width: 40px;
            height: 40px;
            background: var(--gradient-1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group.full-width {
            grid-column: span 3;
        }

        .form-group.half-width {
            grid-column: span 2;
        }

        .form-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-input, .form-select, .form-textarea {
            background: var(--secondary);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 14px 16px;
            color: var(--text-primary);
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
        }

        .form-select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%2394a3b8' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10l-5 5z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 40px;
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-pending { background: rgba(245, 158, 11, 0.15); color: #f59e0b; }
        .status-completed { background: rgba(16, 185, 129, 0.15); color: #10b981; }
        .status-processing { background: rgba(59, 130, 246, 0.15); color: #3b82f6; }
        .status-rejected { background: rgba(239, 68, 68, 0.15); color: #ef4444; }

        /* Table Styles */
        .table-container {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            overflow: hidden;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
        }

        .table-title {
            font-size: 18px;
            font-weight: 700;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            text-align: left;
            padding: 16px 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
            background: var(--secondary);
            border-bottom: 1px solid var(--border);
        }

        .data-table td {
            padding: 16px 20px;
            font-size: 14px;
            border-bottom: 1px solid var(--border);
            vertical-align: middle;
        }

        .data-table tr:hover td {
            background: rgba(245, 158, 11, 0.03);
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        .client-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .client-avatar {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: var(--gradient-1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: var(--primary);
        }

        .client-name {
            font-weight: 600;
        }

        .client-phone {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .action-btns {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .action-btn.delete:hover {
            border-color: var(--danger);
            color: var(--danger);
        }

        /* Progress Tracker */
        .progress-tracker {
            display: flex;
            justify-content: space-between;
            margin: 24px 0;
            padding: 0 20px;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            position: relative;
            flex: 1;
        }

        .progress-step::before {
            content: '';
            position: absolute;
            top: 16px;
            left: 50%;
            width: 100%;
            height: 2px;
            background: var(--border);
        }

        .progress-step:last-child::before {
            display: none;
        }

        .progress-step.completed::before {
            background: var(--success);
        }

        .progress-dot {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--secondary);
            border: 2px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 1;
            font-size: 12px;
            font-weight: 700;
        }

        .progress-step.completed .progress-dot {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        .progress-step.active .progress-dot {
            border-color: var(--accent);
            color: var(--accent);
        }

        .progress-label {
            font-size: 11px;
            color: var(--text-secondary);
            text-align: center;
            max-width: 80px;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(4px);
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlide 0.3s ease;
        }

        @keyframes modalSlide {
            from { opacity: 0; transform: scale(0.95) translateY(-20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px;
            border-bottom: 1px solid var(--border);
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
        }

        .modal-close {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            border-color: var(--danger);
            color: var(--danger);
        }

        .modal-body {
            padding: 24px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            padding: 20px 24px;
            border-top: 1px solid var(--border);
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 2000;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.success { border-left: 4px solid var(--success); }
        .toast.error { border-left: 4px solid var(--danger); }

        /* ==================== LOGIN PAGE STYLES ==================== */
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 50%, #16213e 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 99999;
        }

        .login-overlay::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(245, 158, 11, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(16, 185, 129, 0.05) 0%, transparent 30%);
            pointer-events: none;
        }

        .login-container {
            background: rgba(26, 26, 46, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 48px;
            width: 100%;
            max-width: 420px;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.5);
            position: relative;
            backdrop-filter: blur(20px);
        }

        .login-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .login-logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--accent) 0%, #d97706 100%);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: white;
            box-shadow: 0 10px 30px rgba(245, 158, 11, 0.3);
        }

        .login-header h1 {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .login-header p {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .login-input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .login-input-group label {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .login-input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .login-input-wrapper svg {
            position: absolute;
            left: 16px;
            color: var(--text-muted);
            pointer-events: none;
        }

        .login-input-wrapper input {
            width: 100%;
            padding: 16px 50px;
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 15px;
            transition: all 0.3s ease;
        }

        .login-input-wrapper input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 4px rgba(245, 158, 11, 0.1);
        }

        .login-input-wrapper input::placeholder {
            color: var(--text-muted);
        }

        .toggle-password {
            position: absolute;
            right: 16px;
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px;
            transition: color 0.3s ease;
        }

        .toggle-password:hover {
            color: var(--accent);
        }

        .login-error {
            display: none;
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #ef4444;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 14px;
            text-align: center;
        }

        .login-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 16px 24px;
            background: linear-gradient(135deg, var(--accent) 0%, #d97706 100%);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(245, 158, 11, 0.3);
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(245, 158, 11, 0.4);
        }

        .login-footer {
            margin-top: 32px;
            text-align: center;
        }

        .login-footer p {
            color: var(--text-muted);
            font-size: 12px;
        }

        /* Logout Button */
        .logout-btn {
            margin-top: auto;
            padding: 14px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.2);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
            width: 100%;
        }

        .logout-btn:hover {
            background: rgba(239, 68, 68, 0.2);
        }

        /* Filter Section */
        .filter-section {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 10px 18px;
            border-radius: 20px;
            background: var(--secondary);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-btn:hover, .filter-btn.active {
            border-color: var(--accent);
            color: var(--accent);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .form-grid { grid-template-columns: repeat(2, 1fr); }
            .form-group.full-width { grid-column: span 2; }
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .main-content {
                margin-left: 0;
            }
            .stats-grid { grid-template-columns: 1fr; }
            .form-grid { grid-template-columns: 1fr; }
            .form-group.full-width, .form-group.half-width { grid-column: span 1; }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-dark);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--secondary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--border);
        }
    </style>
</head>
<body>
    <!-- Admin Login Page -->
    <div class="login-overlay" id="loginPage" style="display: none;">
        <div class="login-container">
            <div class="login-header">
                <div class="login-logo">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
                </div>
                <h1>Pavishna Global Service</h1>
                <p>Admin Panel Login</p>
            </div>
            <form class="login-form" onsubmit="handleLogin(event)">
                <div class="login-input-group">
                    <label>Username</label>
                    <div class="login-input-wrapper">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                        <input type="text" id="loginUsername" placeholder="Enter username" required>
                    </div>
                </div>
                <div class="login-input-group">
                    <label>Password</label>
                    <div class="login-input-wrapper">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                        <input type="password" id="loginPassword" placeholder="Enter password" required>
                        <button type="button" class="toggle-password" onclick="togglePasswordVisibility()">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" id="eyeIcon"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                        </button>
                    </div>
                </div>
                <div class="login-error" id="loginError"></div>
                <button type="submit" class="login-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>
                    Login
                </button>
            </form>
            <div class="login-footer">
                <p>Â© 2024 Pavishna Global Service. All rights reserved.</p>
            </div>
        </div>
    </div>

    <!-- Main App (Hidden until login) -->
    <div id="mainApp" style="display: block;">
    <div class="bg-pattern"></div>

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo">
            <div class="logo-icon">PGS</div>
            <div class="logo-text">
                 Pavishna Global Service
                <span>Business Admin</span>
            </div>
        </div>

        <ul class="nav-menu">
            <li class="nav-item">
                <a class="nav-link active" data-section="dashboard" onclick="showSection('dashboard')">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
                    Dashboard
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-section="clients" onclick="showSection('clients')">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                    Clients
                    <span class="nav-badge" id="clientCount">0</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-section="addClient" onclick="showSection('addClient')">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="20" y1="8" x2="20" y2="14"/><line x1="23" y1="11" x2="17" y2="11"/></svg>
                    Add Client
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-section="reports" onclick="showSection('reports')">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
                    Reports
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-section="settings" onclick="showSection('settings')">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
                    Settings
                </a>
            </li>
        </ul>

        <!-- Logout Button -->
        <button class="logout-btn" onclick="logout()">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
            Logout
        </button>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Dashboard Section -->
        <section id="dashboard" class="content-section active">
            <div class="header">
                <h1 class="page-title">Welcome to <span>Pavishna Global Services</span></h1>
                <div class="header-actions">
                    <div class="search-box">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                        <input type="text" placeholder="Search clients..." id="globalSearch" onkeyup="searchClients()">
                    </div>
                    <button class="btn btn-primary" onclick="showSection('addClient')">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        Add Client
                    </button>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon blue">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                    </div>
                    <div class="stat-value" id="totalClients">0</div>
                    <div class="stat-label">Total Clients</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon green">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                    </div>
                    <div class="stat-value" id="visaApproved">0</div>
                    <div class="stat-label">Visa Approved</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon orange">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                    </div>
                    <div class="stat-value" id="pendingProcess">0</div>
                    <div class="stat-label">In Process</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon purple">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                    </div>
                    <div class="stat-value" id="flyingClients">0</div>
                    <div class="stat-label">Ready to Fly</div>
                </div>
            </div>

            <!-- Recent Clients Table -->
            <div class="table-container">
                <div class="table-header">
                    <h3 class="table-title">Recent Clients</h3>
                    <button class="btn btn-secondary" onclick="showSection('clients')">View All</button>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Client</th>
                            <th>Country</th>
                            <th>Interview Status</th>
                            <th>Visa Status</th>
                            <th>Flying Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="recentClientsTable">
                        <tr>
                            <td colspan="6" style="text-align: center; color: var(--text-secondary); padding: 40px;">
                                No clients added yet. Click "Add Client" to get started.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Clients List Section -->
        <section id="clients" class="content-section">
            <div class="header">
                <h1 class="page-title">All <span>Clients</span></h1>
                <div class="header-actions">

                    <div class="search-box">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                        <input type="text" placeholder="Search clients..." id="clientSearch" onkeyup="searchClientsInList()">
                    </div>
                    <button class="btn btn-success" onclick="exportToExcel()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                        Export Excel
                    </button>
                    <button class="btn btn-secondary" onclick="exportToCSV()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                        Export CSV
                    </button>
                    <button class="btn btn-primary" onclick="showSection('addClient')">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        Add Client
                    </button>
                </div>
            </div>

            <!-- Filters -->
            <div class="filter-section">
                <button class="filter-btn active" onclick="filterClients('all', this)">All</button>
                <button class="filter-btn" onclick="filterClients('interview_pending', this)">Interview Pending</button>
                <button class="filter-btn" onclick="filterClients('interview_passed', this)">Interview Passed</button>
                <button class="filter-btn" onclick="filterClients('visa_approved', this)">Visa Approved</button>
                <button class="filter-btn" onclick="filterClients('ready_to_fly', this)">Ready to Fly</button>
                <button class="filter-btn" onclick="filterClients('advance_paid', this)">Advance Paid</button>
                <button class="filter-btn" onclick="filterClients('full_paid', this)">Full Paid</button>
                <button class="filter-btn" onclick="filterClients('payment_pending', this)">Payment Pending</button>
            </div>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Client</th>
                            <th>District</th>
                            <th>Country</th>
                            <th>Job Role</th>
                            <th>Interview</th>
                            <th>Medical</th>
                            <th>Visa</th>
                            <th>Full Payment</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="allClientsTable">
                        <tr>
                            <td colspan="9" style="text-align: center; color: var(--text-secondary); padding: 40px;">
                                No clients added yet.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Add Client Section -->
        <section id="addClient" class="content-section">
            <div class="header">
                <h1 class="page-title">Add New <span>Client</span></h1>
            </div>

            <form id="clientForm" onsubmit="saveClient(event)">
                <!-- Personal Information -->
                <div class="form-card">
                    <div class="form-header">
                        <div class="form-title">
                            <div class="form-title-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                            </div>
                            Personal Information
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Full Name *</label>
                            <input type="text" class="form-input" name="name" required placeholder="Enter full name">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Phone Number *</label>
                            <input type="tel" class="form-input" name="phone" required placeholder="+91 98765 43210">
                        </div>
                        <div class="form-group">
                            <label class="form-label">District *</label>
                            <input type="text" class="form-input" name="district" required placeholder="Enter district">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Job Role *</label>
                            <input type="text" class="form-input" name="job_role" required placeholder="e.g., Driver, Helper, Mason">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Destination Country *</label>
                            <select class="form-select" name="country" required onchange="toggleGulfModules(this.value)">
                                <option value="">Select Country</option>
                                <optgroup label="ðŸŒ´ Gulf Countries (MOFA/VFS/Takamual Required)">
                                    <option value="Saudi Arabia">ðŸ‡¸ðŸ‡¦ Saudi Arabia</option>
                                    <option value="Dubai">ðŸ‡¦ðŸ‡ª Dubai (UAE)</option>
                                    <option value="Oman">ðŸ‡´ðŸ‡² Oman</option>
                                    <option value="Qatar">ðŸ‡¶ðŸ‡¦ Qatar</option>
                                    <option value="Kuwait">ðŸ‡°ðŸ‡¼ Kuwait</option>
                                    <option value="Bahrain">ðŸ‡§ðŸ‡­ Bahrain</option>
                                    <option value="Maldives">ðŸ‡²ðŸ‡» Maldives</option>
                                </optgroup>
                                <optgroup label="ðŸŒ Other Countries">
                                    <option value="Singapore">ðŸ‡¸ðŸ‡¬ Singapore</option>
                                    <option value="Malaysia">ðŸ‡²ðŸ‡¾ Malaysia</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Passport Number</label>
                            <input type="text" class="form-input" name="passport_no" placeholder="Enter passport number">
                        </div>
                    </div>
                </div>

                <!-- Passport & Interview Details -->
                <div class="form-card">
                    <div class="form-header">
                        <div class="form-title">
                            <div class="form-title-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                            </div>
                            Passport Submission
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Passport Submit Date</label>
                            <input type="date" class="form-input" name="passport_submit_date">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Passport Submitted By</label>
                            <select class="form-select" name="passport_submitted_by" onchange="togglePassportFee(this.value)">
                                <option value="client">Client Submitted (No Fee)</option>
                                <option value="agency">Through Agency (â‚¹10,000 Fee)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Passport Status</label>
                            <select class="form-select" name="passport_status">
                                <option value="not_submitted">Not Submitted</option>
                                <option value="submitted">Submitted</option>
                                <option value="under_process">Under Process</option>
                                <option value="received">Received</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Passport Fee Section (Only shows when agency selected) -->
                    <div id="passportFeeSection" style="display: none; margin-top: 20px; padding: 16px; background: rgba(245, 158, 11, 0.1); border-radius: 12px; border: 1px solid rgba(245, 158, 11, 0.2);">
                        <h4 style="color: #f59e0b; margin-bottom: 16px; font-size: 14px;">ðŸ’° Passport Processing Fee (â‚¹10,000)</h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Fee Amount (â‚¹)</label>
                                <input type="number" class="form-input" name="passport_fee" placeholder="10000" value="10000">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Payment Mode</label>
                                <select class="form-select" name="passport_payment_mode">
                                    <option value="">Select Payment Mode</option>
                                    <option value="cash">Cash</option>
                                    <option value="upi">UPI (GPay/PhonePe/Paytm)</option>
                                    <option value="bank_transfer">Bank Transfer / NEFT / IMPS</option>
                                    <option value="cheque">Cheque</option>
                                    <option value="card">Debit/Credit Card</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Payment Status</label>
                                <select class="form-select" name="passport_payment_status">
                                    <option value="pending">Pending</option>
                                    <option value="partial">Partial Paid</option>
                                    <option value="completed">Completed</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Payment Complete Date</label>
                                <input type="date" class="form-input" name="passport_payment_date">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Transaction Reference</label>
                                <input type="text" class="form-input" name="passport_payment_reference" placeholder="Transaction ID / Receipt No">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Interview Details -->
                <div class="form-card">
                    <div class="form-header">
                        <div class="form-title">
                            <div class="form-title-icon" style="background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                            </div>
                            Interview Details
                            <span style="font-size: 12px; font-weight: 400; color: var(--text-secondary); margin-left: 8px;">(Scheduled 3-5 days after passport submission)</span>
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Interview Date</label>
                            <input type="date" class="form-input" name="interview_date">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Interview Time</label>
                            <input type="time" class="form-input" name="interview_time">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Interview Location</label>
                            <input type="text" class="form-input" name="interview_location" placeholder="Enter interview venue">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Interview Status</label>
                            <select class="form-select" name="interview_status" onchange="toggleOfferLetterSection(this.value)">
                                <option value="scheduled">Scheduled</option>
                                <option value="attended">Attended</option>
                                <option value="selected">Selected âœ“</option>
                                <option value="rejected">Rejected âœ—</option>
                                <option value="rescheduled">Rescheduled</option>
                                <option value="absent">Absent</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Reschedule Date (if applicable)</label>
                            <input type="date" class="form-input" name="interview_reschedule_date">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Interview Remarks</label>
                            <input type="text" class="form-input" name="interview_remarks" placeholder="Any notes about interview">
                        </div>
                    </div>
                </div>

                <!-- Offer Letter & Advance Payment Section (Shows when Interview Selected) -->
                <div class="form-card" id="offerLetterSection" style="display: none; border: 2px solid rgba(16, 185, 129, 0.3);">
                    <div class="form-header">
                        <div class="form-title">
                            <div class="form-title-icon" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
                            </div>
                            Offer Letter & Advance Payment
                            <span style="font-size: 12px; font-weight: 400; color: var(--success); margin-left: 8px;">âœ“ Interview Selected</span>
                        </div>
                    </div>
                    
                    <!-- Offer Letter Section -->
                    <div style="margin-bottom: 24px;">
                        <h4 style="color: var(--success); margin-bottom: 16px; font-size: 14px; text-transform: uppercase; letter-spacing: 1px;">ðŸ“„ Offer Letter Details</h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Offer Letter Status</label>
                                <select class="form-select" name="offer_letter_status">
                                    <option value="pending">Pending</option>
                                    <option value="received">Received</option>
                                    <option value="sent_to_client">Sent to Client</option>
                                    <option value="client_accepted">Client Accepted</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Offer Letter Date</label>
                                <input type="date" class="form-input" name="offer_letter_date">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Offer Letter Reference No</label>
                                <input type="text" class="form-input" name="offer_letter_reference" placeholder="Enter reference number">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Company Name (Employer)</label>
                                <input type="text" class="form-input" name="employer_company" placeholder="Enter employer company name">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Offered Salary</label>
                                <input type="text" class="form-input" name="offered_salary" placeholder="e.g., 1500 SAR / 2000 AED">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Contract Duration</label>
                                <select class="form-select" name="contract_duration">
                                    <option value="">Select Duration</option>
                                    <option value="1_year">1 Year</option>
                                    <option value="2_years">2 Years</option>
                                    <option value="3_years">3 Years</option>
                                    <option value="unlimited">Unlimited</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Advance Payment Section -->
                    <div>
                        <h4 style="color: var(--accent); margin-bottom: 16px; font-size: 14px; text-transform: uppercase; letter-spacing: 1px;">ðŸ’° Advance Payment (After Offer Letter)</h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Advance Amount (â‚¹)</label>
                                <input type="number" class="form-input" name="advance_payment" placeholder="Enter advance amount">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Payment Mode</label>
                                <select class="form-select" name="advance_payment_mode">
                                    <option value="">Select Payment Mode</option>
                                    <option value="cash">Cash</option>
                                    <option value="upi">UPI (GPay/PhonePe/Paytm)</option>
                                    <option value="bank_transfer">Bank Transfer / NEFT / IMPS</option>
                                    <option value="cheque">Cheque</option>
                                    <option value="card">Debit/Credit Card</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Payment Status</label>
                                <select class="form-select" name="advance_payment_status">
                                    <option value="pending">Pending</option>
                                    <option value="partial">Partial Paid</option>
                                    <option value="completed">Completed</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Payment Date</label>
                                <input type="date" class="form-input" name="advance_payment_date">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Payment Time</label>
                                <input type="time" class="form-input" name="advance_payment_time">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Transaction Reference</label>
                                <input type="text" class="form-input" name="advance_payment_reference" placeholder="Transaction ID / Receipt No">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Medical Details -->
                <div class="form-card">
                    <div class="form-header">
                        <div class="form-title">
                            <div class="form-title-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
                            </div>
                            Medical Details
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Medical Status</label>
                            <select class="form-select" name="medical_status">
                                <option value="pending">Pending</option>
                                <option value="scheduled">Scheduled</option>
                                <option value="fit">Fit</option>
                                <option value="unfit">Unfit</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Medical Date</label>
                            <input type="date" class="form-input" name="medical_date">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Medical Report No</label>
                            <input type="text" class="form-input" name="medical_report_no" placeholder="Enter report number">
                        </div>
                    </div>
                </div>

                <!-- Gulf Countries Special Modules - MOFA, VFS, Takamual -->
                <div class="form-card gulf-module" id="gulfModules" style="display: none; border: 2px solid rgba(139, 92, 246, 0.3); background: linear-gradient(135deg, rgba(139, 92, 246, 0.05) 0%, rgba(109, 40, 217, 0.05) 100%);">
                    <div class="form-header">
                        <div class="form-title">
                            <div class="form-title-icon" style="background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
                            </div>
                            ðŸŒ´ Gulf Countries Special Process
                            <span style="font-size: 12px; font-weight: 400; color: #8b5cf6; margin-left: 8px; background: rgba(139, 92, 246, 0.2); padding: 4px 10px; border-radius: 20px;">MOFA â€¢ VFS â€¢ Takamual</span>
                        </div>
                    </div>
                    
                    <div style="background: rgba(139, 92, 246, 0.1); padding: 12px 16px; border-radius: 8px; margin-bottom: 24px; border-left: 4px solid #8b5cf6;">
                        <p style="color: var(--text-secondary); font-size: 13px; margin: 0;">
                            â„¹ï¸ Gulf countries (Saudi Arabia, Dubai, Oman, Qatar, Kuwait, Bahrain, Maldives) require additional MOFA, VFS, and Takamual processes for visa approval.
                        </p>
                    </div>
                    
                    <!-- MOFA Section -->
                    <div style="margin-bottom: 24px;">
                        <h4 style="color: var(--accent); margin-bottom: 16px; font-size: 14px; text-transform: uppercase; letter-spacing: 1px;">ðŸ“‹ MOFA Application Process</h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">MOFA Status</label>
                                <select class="form-select" name="mofa_status">
                                    <option value="not_applied">Not Applied</option>
                                    <option value="applied">Applied</option>
                                    <option value="processing">Processing</option>
                                    <option value="approved">Approved</option>
                                    <option value="rejected">Rejected</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">MOFA Number</label>
                                <input type="text" class="form-input" name="mofa_number" placeholder="Enter MOFA number">
                            </div>
                            <div class="form-group">
                                <label class="form-label">MOFA Date</label>
                                <input type="date" class="form-input" name="mofa_date">
                            </div>
                        </div>
                    </div>

                    <!-- VFS Section -->
                    <div style="margin-bottom: 24px;">
                        <h4 style="color: var(--info); margin-bottom: 16px; font-size: 14px; text-transform: uppercase; letter-spacing: 1px;">ðŸ¢ VFS Process</h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">VFS Status</label>
                                <select class="form-select" name="vfs_status">
                                    <option value="not_applied">Not Applied</option>
                                    <option value="appointment_booked">Appointment Booked</option>
                                    <option value="documents_submitted">Documents Submitted</option>
                                    <option value="processing">Processing</option>
                                    <option value="completed">Completed</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">VFS Appointment Date</label>
                                <input type="date" class="form-input" name="vfs_appointment_date">
                            </div>
                            <div class="form-group">
                                <label class="form-label">VFS Reference No</label>
                                <input type="text" class="form-input" name="vfs_reference_no" placeholder="Enter VFS reference">
                            </div>
                        </div>
                    </div>

                    <!-- Takamual Section -->
                    <div>
                        <h4 style="color: var(--success); margin-bottom: 16px; font-size: 14px; text-transform: uppercase; letter-spacing: 1px;">âœ… Takamual Test Process</h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Takamual Status</label>
                                <select class="form-select" name="takamual_status">
                                    <option value="not_required">Not Required</option>
                                    <option value="pending">Pending</option>
                                    <option value="scheduled">Scheduled</option>
                                    <option value="passed">Passed</option>
                                    <option value="failed">Failed</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Takamual Test Date</label>
                                <input type="date" class="form-input" name="takamual_date">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Takamual Certificate No</label>
                                <input type="text" class="form-input" name="takamual_certificate_no" placeholder="Enter certificate number">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Visa & Agreement Details -->
                <div class="form-card">
                    <div class="form-header">
                        <div class="form-title">
                            <div class="form-title-icon" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                            </div>
                            Visa Details
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Visa Status</label>
                            <select class="form-select" name="visa_status">
                                <option value="not_applied">Not Applied</option>
                                <option value="applied">Applied</option>
                                <option value="processing">Processing</option>
                                <option value="approved">Approved</option>
                                <option value="rejected">Rejected</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Visa Number</label>
                            <input type="text" class="form-input" name="visa_number" placeholder="Enter visa number">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Visa Expiry Date</label>
                            <input type="date" class="form-input" name="visa_expiry_date">
                        </div>
                    </div>
                </div>

                <!-- Agreement Section with PDF Generation -->
                <div class="form-card" style="border: 2px solid rgba(139, 92, 246, 0.3);">
                    <div class="form-header">
                        <div class="form-title">
                            <div class="form-title-icon" style="background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
                            </div>
                            Client Agreement
                            <span style="font-size: 12px; font-weight: 400; color: var(--text-secondary); margin-left: 8px;">ðŸ“„ Generate PDF</span>
                        </div>
                        <button type="button" class="btn btn-secondary" onclick="openAgreementModal()" style="font-size: 13px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="12" y1="18" x2="12" y2="12"/><line x1="9" y1="15" x2="15" y2="15"/></svg>
                            Create Agreement PDF
                        </button>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Agreement Status</label>
                            <select class="form-select" name="agreement_process">
                                <option value="not_created">Not Created</option>
                                <option value="draft">Draft Created</option>
                                <option value="sent_to_client">Sent to Client</option>
                                <option value="client_signed">Client Signed âœ“</option>
                                <option value="completed">Completed</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Agreement Date</label>
                            <input type="date" class="form-input" name="agreement_date">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Agreement Number</label>
                            <input type="text" class="form-input" name="agreement_number" placeholder="AGR-2024-001">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Client Signed?</label>
                            <select class="form-select" name="client_signed">
                                <option value="no">No - Not Yet Signed</option>
                                <option value="yes">Yes - Client Signed âœ“</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Signature Date</label>
                            <input type="date" class="form-input" name="signature_date">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Witness Name</label>
                            <input type="text" class="form-input" name="witness_name" placeholder="Enter witness name">
                        </div>
                    </div>
                </div>

                <!-- Final Payment & Flying Details -->
                <div class="form-card">
                    <div class="form-header">
                        <div class="form-title">
                            <div class="form-title-icon" style="background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                            </div>
                            Final Payment & Flying Details
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Full/Final Payment (â‚¹)</label>
                            <input type="number" class="form-input" name="full_payment" placeholder="0" value="0">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Final Payment Mode</label>
                            <select class="form-select" name="full_payment_mode">
                                <option value="">Select Payment Mode</option>
                                <option value="cash">Cash</option>
                                <option value="upi">UPI (GPay/PhonePe/Paytm)</option>
                                <option value="bank_transfer">Bank Transfer / NEFT / IMPS</option>
                                <option value="cheque">Cheque</option>
                                <option value="card">Debit/Credit Card</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Final Payment Date</label>
                            <input type="date" class="form-input" name="full_payment_date">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Flying Date</label>
                            <input type="date" class="form-input" name="flying_date">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Flight Details</label>
                            <input type="text" class="form-input" name="flight_details" placeholder="Flight number, airline, time">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ticket Status</label>
                            <select class="form-select" name="ticket_status">
                                <option value="not_booked">Not Booked</option>
                                <option value="booked">Booked</option>
                                <option value="issued">Ticket Issued</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Remarks -->
                <div class="form-card">
                    <div class="form-header">
                        <div class="form-title">
                            <div class="form-title-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
                            </div>
                            Additional Notes
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group full-width">
                            <label class="form-label">Remarks</label>
                            <textarea class="form-textarea" name="remarks" placeholder="Add any additional notes or remarks..."></textarea>
                        </div>
                    </div>
                </div>

                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" onclick="resetForm()">Reset</button>
                    <button type="submit" class="btn btn-primary">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                        Save Client
                    </button>
                </div>
            </form>
        </section>

        <!-- Reports Section -->
        <section id="reports" class="content-section">
            <div class="header">
                <h1 class="page-title">Reports & <span>Analytics</span></h1>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="refreshReports()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/></svg>
                        Refresh
                    </button>
                    <button class="btn btn-secondary" onclick="exportReportPDF()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                        Export PDF
                    </button>
                </div>
            </div>

            <!-- Summary Stats -->
            <div class="stats-grid" style="margin-bottom: 24px;">
                <div class="stat-card">
                    <div class="stat-icon blue">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>
                    </div>
                    <div class="stat-value" id="reportTotalClients">0</div>
                    <div class="stat-label">Total Clients</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon green">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
                    </div>
                    <div class="stat-value" id="reportTotalRevenue">â‚¹0</div>
                    <div class="stat-label">Total Revenue</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon orange">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                    </div>
                    <div class="stat-value" id="reportSuccessRate">0%</div>
                    <div class="stat-label">Success Rate</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon purple">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
                    </div>
                    <div class="stat-value" id="reportCountries">0</div>
                    <div class="stat-label">Countries</div>
                </div>
            </div>

            <!-- Charts Row 1 -->
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px; margin-bottom: 24px;">
                <!-- Country Distribution Pie Chart -->
                <div class="form-card">
                    <div class="form-header">
                        <div class="form-title">
                            <div class="form-title-icon" style="background: rgba(59, 130, 246, 0.2); color: #3b82f6;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
                            </div>
                            Clients by Country
                        </div>
                    </div>
                    <div style="height: 300px; display: flex; align-items: center; justify-content: center;">
                        <canvas id="countryPieChart"></canvas>
                    </div>
                </div>

                <!-- Visa Status Pie Chart -->
                <div class="form-card">
                    <div class="form-header">
                        <div class="form-title">
                            <div class="form-title-icon" style="background: rgba(16, 185, 129, 0.2); color: #10b981;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
                            </div>
                            Visa Status Distribution
                        </div>
                    </div>
                    <div style="height: 300px; display: flex; align-items: center; justify-content: center;">
                        <canvas id="visaPieChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Charts Row 2 -->
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px; margin-bottom: 24px;">
                <!-- Interview Status Pie Chart -->
                <div class="form-card">
                    <div class="form-header">
                        <div class="form-title">
                            <div class="form-title-icon" style="background: rgba(245, 158, 11, 0.2); color: #f59e0b;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                            </div>
                            Interview Status
                        </div>
                    </div>
                    <div style="height: 300px; display: flex; align-items: center; justify-content: center;">
                        <canvas id="interviewPieChart"></canvas>
                    </div>
                </div>

                <!-- Payment Status Pie Chart -->
                <div class="form-card">
                    <div class="form-header">
                        <div class="form-title">
                            <div class="form-title-icon" style="background: rgba(139, 92, 246, 0.2); color: #8b5cf6;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
                            </div>
                            Payment Collection
                        </div>
                    </div>
                    <div style="height: 300px; display: flex; align-items: center; justify-content: center;">
                        <canvas id="paymentPieChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Monthly Bar Chart -->
            <div class="form-card" style="margin-bottom: 24px;">
                <div class="form-header">
                    <div class="form-title">
                        <div class="form-title-icon" style="background: rgba(236, 72, 153, 0.2); color: #ec4899;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
                        </div>
                        Monthly Client Registration
                    </div>
                </div>
                <div style="height: 350px;">
                    <canvas id="monthlyBarChart"></canvas>
                </div>
            </div>

            <!-- Revenue Bar Chart -->
            <div class="form-card" style="margin-bottom: 24px;">
                <div class="form-header">
                    <div class="form-title">
                        <div class="form-title-icon" style="background: rgba(34, 197, 94, 0.2); color: #22c55e;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
                        </div>
                        Revenue by Country
                    </div>
                </div>
                <div style="height: 350px;">
                    <canvas id="revenueBarChart"></canvas>
                </div>
            </div>

            <!-- Detailed Stats Table -->
            <div class="form-card">
                <div class="form-header">
                    <div class="form-title">
                        <div class="form-title-icon" style="background: rgba(59, 130, 246, 0.2); color: #3b82f6;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
                        </div>
                        Country-wise Detailed Report
                    </div>
                </div>
                <div class="table-container" style="margin-top: 16px;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Country</th>
                                <th>Total Clients</th>
                                <th>Interview Passed</th>
                                <th>Visa Approved</th>
                                <th>Ready to Fly</th>
                                <th>Total Revenue</th>
                                <th>Success Rate</th>
                            </tr>
                        </thead>
                        <tbody id="countryReportTable">
                            <tr>
                                <td colspan="7" style="text-align: center; color: var(--text-secondary); padding: 40px;">
                                    Loading report data...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Settings Section -->
        <section id="settings" class="content-section">
            <div class="header">
                <h1 class="page-title">Settings</h1>
            </div>
            <div class="form-card">
                <div class="form-header">
                    <div class="form-title">
                        <div class="form-title-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 1-2 2Zm0 0a2 2 0 0 1-2-2v-9c0-1.1.9-2 2-2h2"/></svg>
                            </div>
                        Data Management
                    </div>
                </div>
                <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                    <button class="btn btn-secondary" onclick="exportToCSV()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                        Export All Data (CSV)
                    </button>
                    <button class="btn btn-danger" onclick="clearAllData()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                        Clear All Data
                    </button>
                </div>
            </div>
        </section>
    </main>

    <!-- View Client Modal -->
    <div class="modal-overlay" id="viewModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Client Details</h3>
                <button class="modal-close" onclick="closeModal('viewModal')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                </button>
            </div>
            <div class="modal-body" id="viewModalBody">
                <!-- Content will be injected here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('viewModal')">Close</button>
                <button class="btn btn-primary" id="editFromViewBtn">Edit Client</button>
            </div>
        </div>
    </div>

    <!-- Edit Client Modal -->
    <div class="modal-overlay" id="editModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Edit Client</h3>
                <button class="modal-close" onclick="closeModal('editModal')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                </button>
            </div>
            <div class="modal-body" id="editModalBody">
                <!-- Edit form will be injected here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('editModal')">Cancel</button>
                <button class="btn btn-primary" onclick="updateClient()">Update Client</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
        <span id="toastMessage">Success!</span>
    </div>

    <!-- Agreement PDF Modal -->
    <div class="modal-overlay" id="agreementModal">
        <div class="modal" style="max-width: 1000px;">
            <div class="modal-header">
                <h3 class="modal-title">ðŸ“„ Client Agreement - Edit & Download PDF</h3>
                <button class="modal-close" onclick="closeModal('agreementModal')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-grid" style="margin-bottom: 20px;">
                    <div class="form-group">
                        <label class="form-label">Select Client</label>
                        <select class="form-select" id="agreementClientSelect" onchange="loadClientForAgreement()">
                            <option value="">-- Select Client --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Agreement Number</label>
                        <input type="text" class="form-input" id="agr_number" placeholder="AGR-2024-001">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Agreement Date</label>
                        <input type="date" class="form-input" id="agr_date">
                    </div>
                </div>

                <!-- Agreement Preview/Edit Area -->
                <div id="agreementPreview" style="background: white; color: #1a1a1a; padding: 40px; border-radius: 12px; min-height: 600px; font-family: 'Times New Roman', serif;">
                    <div style="text-align: center; margin-bottom: 30px;">
                        <h1 style="font-size: 24px; font-weight: bold; margin-bottom: 5px; color: #1a1a1a;">GLOBAL SERVICE BUSINESS</h1>
                        <p style="font-size: 14px; color: #666;">Overseas Recruitment & Manpower Consultancy</p>
                        <p style="font-size: 12px; color: #888;">Address: [Your Company Address] | Phone: [Your Phone] | Email: [Your Email]</p>
                        <hr style="border: 2px solid #f59e0b; margin: 20px 0;">
                        <h2 style="font-size: 20px; text-transform: uppercase; letter-spacing: 2px; color: #1a1a1a;">EMPLOYMENT AGREEMENT</h2>
                    </div>

                    <div style="line-height: 1.8; font-size: 14px;">
                        <p><strong>Agreement No:</strong> <span id="preview_agr_no" contenteditable="true" style="border-bottom: 1px dashed #ccc; padding: 2px 10px;">AGR-2024-001</span></p>
                        <p><strong>Date:</strong> <span id="preview_date" contenteditable="true" style="border-bottom: 1px dashed #ccc; padding: 2px 10px;">[Date]</span></p>
                        
                        <br>
                        <p>This Employment Agreement is entered into between:</p>
                        <br>
                        
                        <p><strong>GLOBAL SERVICE BUSINESS</strong> (hereinafter referred to as "The Agency")</p>
                        <p>AND</p>
                        <br>
                        
                        <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                            <tr>
                                <td style="padding: 8px; border: 1px solid #ddd; width: 30%;"><strong>Client Name:</strong></td>
                                <td style="padding: 8px; border: 1px solid #ddd;" contenteditable="true" id="preview_name">[Client Name]</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid #ddd;"><strong>Phone Number:</strong></td>
                                <td style="padding: 8px; border: 1px solid #ddd;" contenteditable="true" id="preview_phone">[Phone]</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid #ddd;"><strong>District:</strong></td>
                                <td style="padding: 8px; border: 1px solid #ddd;" contenteditable="true" id="preview_district">[District]</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid #ddd;"><strong>Passport Number:</strong></td>
                                <td style="padding: 8px; border: 1px solid #ddd;" contenteditable="true" id="preview_passport">[Passport No]</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid #ddd;"><strong>Destination Country:</strong></td>
                                <td style="padding: 8px; border: 1px solid #ddd;" contenteditable="true" id="preview_country">[Country]</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid #ddd;"><strong>Job Role:</strong></td>
                                <td style="padding: 8px; border: 1px solid #ddd;" contenteditable="true" id="preview_job">[Job Role]</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid #ddd;"><strong>Employer Company:</strong></td>
                                <td style="padding: 8px; border: 1px solid #ddd;" contenteditable="true" id="preview_employer">[Employer Company]</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid #ddd;"><strong>Monthly Salary:</strong></td>
                                <td style="padding: 8px; border: 1px solid #ddd;" contenteditable="true" id="preview_salary">[Salary]</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid #ddd;"><strong>Contract Duration:</strong></td>
                                <td style="padding: 8px; border: 1px solid #ddd;" contenteditable="true" id="preview_duration">[Duration]</td>
                            </tr>
                        </table>

                        <br>
                        <h3 style="color: #1a1a1a;">TERMS AND CONDITIONS:</h3>
                        <ol style="margin-left: 20px;">
                            <li contenteditable="true" style="margin-bottom: 10px;">The Client agrees to pay all processing fees as per the agreed schedule.</li>
                            <li contenteditable="true" style="margin-bottom: 10px;">The Agency will arrange visa processing, medical examination, and travel arrangements.</li>
                            <li contenteditable="true" style="margin-bottom: 10px;">The Client must provide all required documents within the specified timeframe.</li>
                            <li contenteditable="true" style="margin-bottom: 10px;">Any false information provided may result in cancellation without refund.</li>
                            <li contenteditable="true" style="margin-bottom: 10px;">The Agency is not responsible for visa rejection by the embassy.</li>
                            <li contenteditable="true" style="margin-bottom: 10px;">Processing fee is non-refundable once the visa process has started.</li>
                            <li contenteditable="true" style="margin-bottom: 10px;">The Client agrees to abide by the rules and regulations of the destination country.</li>
                        </ol>

                        <br>
                        <h3 style="color: #1a1a1a;">PAYMENT DETAILS:</h3>
                        <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                            <tr>
                                <td style="padding: 8px; border: 1px solid #ddd;"><strong>Total Service Fee:</strong></td>
                                <td style="padding: 8px; border: 1px solid #ddd;" contenteditable="true" id="preview_total_fee">â‚¹ [Total Amount]</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid #ddd;"><strong>Advance Paid:</strong></td>
                                <td style="padding: 8px; border: 1px solid #ddd;" contenteditable="true" id="preview_advance">â‚¹ [Advance Amount]</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid #ddd;"><strong>Balance Amount:</strong></td>
                                <td style="padding: 8px; border: 1px solid #ddd;" contenteditable="true" id="preview_balance">â‚¹ [Balance]</td>
                            </tr>
                        </table>

                        <br><br>
                        <p>I have read and understood all the terms and conditions mentioned above. I agree to abide by them.</p>
                        <br><br>

                        <div style="display: flex; justify-content: space-between; margin-top: 50px;">
                            <div style="text-align: center; width: 45%;">
                                <div style="border-top: 1px solid #1a1a1a; padding-top: 10px; margin-top: 60px;">
                                    <p><strong>Client Signature</strong></p>
                                    <p contenteditable="true" id="preview_client_sign">[Client Name]</p>
                                    <p>Date: <span contenteditable="true">______________</span></p>
                                </div>
                            </div>
                            <div style="text-align: center; width: 45%;">
                                <div style="border-top: 1px solid #1a1a1a; padding-top: 10px; margin-top: 60px;">
                                    <p><strong>Agency Representative</strong></p>
                                    <p contenteditable="true">Global Service Business</p>
                                    <p>Date: <span contenteditable="true">______________</span></p>
                                </div>
                            </div>
                        </div>

                        <br><br>
                        <div style="text-align: center; margin-top: 30px;">
                            <p><strong>Witness:</strong></p>
                            <p>Name: <span contenteditable="true" id="preview_witness" style="border-bottom: 1px dashed #ccc; padding: 2px 30px;">______________</span></p>
                            <p>Signature: __________________ &nbsp;&nbsp;&nbsp; Date: ______________</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('agreementModal')">Cancel</button>
                <button class="btn btn-primary" onclick="downloadAgreementPDF()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                    Download PDF
                </button>
            </div>
        </div>
    </div>

    <script>
        // Database (using Flask API + SQLite)
        let clients = [];
        let currentEditId = null;

        // Gulf countries list
        const gulfCountries = ['Maldives', 'Saudi Arabia', 'Dubai', 'Oman', 'Qatar', 'Kuwait', 'Bahrain'];

        function isGulfCountry(country) {
            return gulfCountries.includes(country);
        }

        // Load clients from Flask API
        async function loadClients() {
            try {
                const response = await fetch('/api/clients');
                clients = await response.json();
            } catch (error) {
                clients = [];
            }
            updateDashboard();
            renderTables();
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Hide login, show main app (Flask handles auth)
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            loadClients();
            
            // Add country change listener
            const countrySelect = document.querySelector('select[name="country"]');
            if (countrySelect) {
                countrySelect.addEventListener('change', function() {
                    toggleGulfModules(this.value);
                });
                // Initial check
                toggleGulfModules(countrySelect.value);
            }
        });

        // Toggle Gulf Modules visibility
        function toggleGulfModules(country) {
            const gulfModules = document.getElementById('gulfModules');
            if (gulfModules) {
                if (isGulfCountry(country)) {
                    gulfModules.style.display = 'block';
                    gulfModules.style.animation = 'fadeIn 0.3s ease';
                } else {
                    gulfModules.style.display = 'none';
                }
            }
        }

        // Toggle Passport Fee Section
        function togglePassportFee(submittedBy) {
            const feeSection = document.getElementById('passportFeeSection');
            if (feeSection) {
                if (submittedBy === 'agency') {
                    feeSection.style.display = 'block';
                    feeSection.style.animation = 'fadeIn 0.3s ease';
                } else {
                    feeSection.style.display = 'none';
                }
            }
        }

        // Toggle Offer Letter Section based on Interview Status
        function toggleOfferLetterSection(status) {
            const offerSection = document.getElementById('offerLetterSection');
            if (offerSection) {
                if (status === 'selected') {
                    offerSection.style.display = 'block';
                    offerSection.style.animation = 'fadeIn 0.3s ease';
                } else {
                    offerSection.style.display = 'none';
                }
            }
        }

        // Toggle Edit Offer Section
        function toggleEditOfferSection(status) {
            const offerSection = document.getElementById('editOfferSection');
            if (offerSection) {
                if (status === 'selected') {
                    offerSection.style.display = 'block';
                    offerSection.style.animation = 'fadeIn 0.3s ease';
                } else {
                    offerSection.style.display = 'none';
                }
            }
        }

        // Show Section
        function showSection(sectionId) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');

            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.dataset.section === sectionId) {
                    link.classList.add('active');
                }
            });
            
            // Generate reports when showing reports section
            if (sectionId === 'reports') {
                setTimeout(generateReports, 100);
            }
        }

        // Save Client - API
        async function saveClient(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            const client = {};
            formData.forEach((value, key) => { client[key] = value; });

            try {
                const response = await fetch('/api/clients', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(client)
                });
                const result = await response.json();
                if (result.success) {
                    await loadClients();
                    form.reset();
                    showToast('Client added successfully!', 'success');
                    showSection('clients');
                }
            } catch (error) {
                showToast('Error adding client!', 'error');
            }
        }

        // Data saved via API
        function saveToStorage() { }

        // Update Dashboard Stats
        function updateDashboard() {
            document.getElementById('totalClients').textContent = clients.length;
            document.getElementById('clientCount').textContent = clients.length;
            
            const visaApproved = clients.filter(c => c.visa_status === 'approved').length;
            document.getElementById('visaApproved').textContent = visaApproved;

            const pending = clients.filter(c => c.visa_status === 'processing' || c.visa_status === 'applied').length;
            document.getElementById('pendingProcess').textContent = pending;

            const readyToFly = clients.filter(c => c.visa_status === 'approved' && c.flying_date).length;
            document.getElementById('flyingClients').textContent = readyToFly;
        }

        // Render Tables
        function renderTables(filteredClients = null) {
            const clientsToRender = filteredClients || clients;
            
            // Recent Clients (last 5)
            const recentTable = document.getElementById('recentClientsTable');
            const recent = [...clientsToRender].reverse().slice(0, 5);
            
            if (recent.length === 0) {
                recentTable.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; color: var(--text-secondary); padding: 40px;">
                            No clients added yet. Click "Add Client" to get started.
                        </td>
                    </tr>
                `;
            } else {
                recentTable.innerHTML = recent.map(client => `
                    <tr>
                        <td>
                            <div class="client-info">
                                <div class="client-avatar">${client.name.charAt(0).toUpperCase()}</div>
                                <div>
                                    <div class="client-name">${client.name}</div>
                                    <div class="client-phone">${client.phone}</div>
                                </div>
                            </div>
                        </td>
                        <td>${client.country} ${isGulfCountry(client.country) ? '<span style="color: #8b5cf6; font-size: 10px;">â—Gulf</span>' : ''}</td>
                        <td><span class="status-badge status-${getStatusClass(client.interview_status)}">${formatStatus(client.interview_status)}</span></td>
                        <td><span class="status-badge status-${getVisaStatusClass(client.visa_status)}">${formatStatus(client.visa_status)}</span></td>
                        <td>${client.flying_date || '-'}</td>
                        <td>
                            <div class="action-btns">
                                <button class="action-btn" onclick="viewClient(${client.id})" title="View">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                                </button>
                                <button class="action-btn" onclick="editClient(${client.id})" title="Edit">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                                </button>
                                <button class="action-btn" onclick="exportSingleClientToExcel(${client.id})" title="Export Excel" style="color: #10b981;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                                </button>
                                <button class="action-btn delete" onclick="deleteClient(${client.id})" title="Delete">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            }

            // All Clients Table
            const allTable = document.getElementById('allClientsTable');
            if (clientsToRender.length === 0) {
                allTable.innerHTML = `
                    <tr>
                        <td colspan="9" style="text-align: center; color: var(--text-secondary); padding: 40px;">
                            No clients found.
                        </td>
                    </tr>
                `;
            } else {
                allTable.innerHTML = [...clientsToRender].reverse().map(client => `
                    <tr>
                        <td>
                            <div class="client-info">
                                <div class="client-avatar">${client.name.charAt(0).toUpperCase()}</div>
                                <div>
                                    <div class="client-name">${client.name}</div>
                                    <div class="client-phone">${client.phone}</div>
                                </div>
                            </div>
                        </td>
                        <td>${client.district}</td>
                        <td>${client.country} ${isGulfCountry(client.country) ? '<span style="color: #8b5cf6; font-size: 10px;">â—Gulf</span>' : ''}</td>
                        <td>${client.job_role}</td>
                        <td><span class="status-badge status-${getStatusClass(client.interview_status)}">${formatStatus(client.interview_status)}</span></td>
                        <td><span class="status-badge status-${getStatusClass(client.medical_status)}">${formatStatus(client.medical_status)}</span></td>
                        <td><span class="status-badge status-${getVisaStatusClass(client.visa_status)}">${formatStatus(client.visa_status)}</span></td>
                        <td>â‚¹${Number(client.full_payment || 0).toLocaleString()}</td>
                        <td>
                            <div class="action-btns">
                                <button class="action-btn" onclick="viewClient(${client.id})" title="View">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                                </button>
                                <button class="action-btn" onclick="editClient(${client.id})" title="Edit">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                                </button>
                                <button class="action-btn" onclick="exportSingleClientToExcel(${client.id})" title="Export Excel" style="color: #10b981;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                                </button>
                                <button class="action-btn delete" onclick="deleteClient(${client.id})" title="Delete">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            }
        }

        // Helper Functions
        function getStatusClass(status) {
            const map = {
                'pending': 'pending',
                'scheduled': 'processing',
                'passed': 'completed',
                'failed': 'rejected',
                'fit': 'completed',
                'unfit': 'rejected'
            };
            return map[status] || 'pending';
        }

        function getVisaStatusClass(status) {
            const map = {
                'not_applied': 'pending',
                'applied': 'processing',
                'processing': 'processing',
                'approved': 'completed',
                'rejected': 'rejected'
            };
            return map[status] || 'pending';
        }

        function formatStatus(status) {
            return status.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        }

        // View Client
        function viewClient(id) {
            const client = clients.find(c => c.id === id);
            if (!client) return;

            const isGulf = isGulfCountry(client.country);
            
            // Gulf specific progress steps
            const gulfProgressSteps = isGulf ? `
                <div class="progress-step ${client.mofa_status === 'approved' ? 'completed' : client.mofa_status === 'processing' ? 'active' : ''}">
                    <div class="progress-dot">4</div>
                    <div class="progress-label">MOFA</div>
                </div>
                <div class="progress-step ${client.vfs_status === 'completed' ? 'completed' : client.vfs_status === 'processing' ? 'active' : ''}">
                    <div class="progress-dot">5</div>
                    <div class="progress-label">VFS</div>
                </div>
                <div class="progress-step ${client.takamual_status === 'passed' ? 'completed' : client.takamual_status === 'scheduled' ? 'active' : ''}">
                    <div class="progress-dot">6</div>
                    <div class="progress-label">Takamual</div>
                </div>
                <div class="progress-step ${client.visa_status === 'approved' ? 'completed' : client.visa_status === 'processing' ? 'active' : ''}">
                    <div class="progress-dot">7</div>
                    <div class="progress-label">Visa</div>
                </div>
                <div class="progress-step ${client.agreement_process === 'completed' ? 'completed' : client.agreement_process === 'in_progress' ? 'active' : ''}">
                    <div class="progress-dot">8</div>
                    <div class="progress-label">Agreement</div>
                </div>
                <div class="progress-step ${client.flying_date && client.visa_status === 'approved' ? 'completed' : ''}">
                    <div class="progress-dot">9</div>
                    <div class="progress-label">Flying</div>
                </div>
            ` : `
                <div class="progress-step ${client.visa_status === 'approved' ? 'completed' : client.visa_status === 'processing' ? 'active' : ''}">
                    <div class="progress-dot">4</div>
                    <div class="progress-label">Visa</div>
                </div>
                <div class="progress-step ${client.agreement_process === 'completed' ? 'completed' : client.agreement_process === 'in_progress' ? 'active' : ''}">
                    <div class="progress-dot">5</div>
                    <div class="progress-label">Agreement</div>
                </div>
                <div class="progress-step ${client.flying_date && client.visa_status === 'approved' ? 'completed' : ''}">
                    <div class="progress-dot">6</div>
                    <div class="progress-label">Flying</div>
                </div>
            `;

            // Gulf specific details
            const gulfDetails = isGulf ? `
                <div style="grid-column: span 3; margin: 20px 0; padding: 20px; background: rgba(139, 92, 246, 0.1); border-radius: 12px; border: 1px solid rgba(139, 92, 246, 0.2);">
                    <h4 style="color: #8b5cf6; margin-bottom: 16px;">ðŸŒ™ Gulf Process Details</h4>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">MOFA Status</label>
                            <div style="padding: 8px 0;"><span class="status-badge status-${getVisaStatusClass(client.mofa_status)}">${formatStatus(client.mofa_status || 'not_applied')}</span></div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">MOFA Number</label>
                            <div style="padding: 8px 0; font-size: 14px;">${client.mofa_number || '-'}</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">MOFA Date</label>
                            <div style="padding: 8px 0; font-size: 14px;">${client.mofa_date || '-'}</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">VFS Status</label>
                            <div style="padding: 8px 0;"><span class="status-badge status-${getVfsStatusClass(client.vfs_status)}">${formatStatus(client.vfs_status || 'not_applied')}</span></div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">VFS Appointment</label>
                            <div style="padding: 8px 0; font-size: 14px;">${client.vfs_appointment_date || '-'}</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">VFS Reference</label>
                            <div style="padding: 8px 0; font-size: 14px;">${client.vfs_reference_no || '-'}</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Takamual Status</label>
                            <div style="padding: 8px 0;"><span class="status-badge status-${getStatusClass(client.takamual_status)}">${formatStatus(client.takamual_status || 'not_required')}</span></div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Takamual Date</label>
                            <div style="padding: 8px 0; font-size: 14px;">${client.takamual_date || '-'}</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Takamual Certificate</label>
                            <div style="padding: 8px 0; font-size: 14px;">${client.takamual_certificate_no || '-'}</div>
                        </div>
                    </div>
                </div>
            ` : '';

            const modalBody = document.getElementById('viewModalBody');
            modalBody.innerHTML = `
                <div class="progress-tracker">
                    <div class="progress-step ${client.passport_no ? 'completed' : 'active'}">
                        <div class="progress-dot">1</div>
                        <div class="progress-label">Passport</div>
                    </div>
                    <div class="progress-step ${client.interview_status === 'passed' ? 'completed' : client.interview_status === 'scheduled' ? 'active' : ''}">
                        <div class="progress-dot">2</div>
                        <div class="progress-label">Interview</div>
                    </div>
                    <div class="progress-step ${client.medical_status === 'fit' ? 'completed' : client.medical_status === 'scheduled' ? 'active' : ''}">
                        <div class="progress-dot">3</div>
                        <div class="progress-label">Medical</div>
                    </div>
                    ${gulfProgressSteps}
                </div>

                <div class="form-grid" style="margin-top: 24px;">
                    <div class="form-group">
                        <label class="form-label">Full Name</label>
                        <div style="padding: 14px 0; font-size: 15px;">${client.name}</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Phone Number</label>
                        <div style="padding: 14px 0; font-size: 15px;">${client.phone}</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">District</label>
                        <div style="padding: 14px 0; font-size: 15px;">${client.district}</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Job Role</label>
                        <div style="padding: 14px 0; font-size: 15px;">${client.job_role}</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Country</label>
                        <div style="padding: 14px 0; font-size: 15px;">${client.country} ${isGulf ? 'ðŸŒ™' : ''}</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Passport No</label>
                        <div style="padding: 14px 0; font-size: 15px;">${client.passport_no || '-'}</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Passport Submit Date</label>
                        <div style="padding: 14px 0; font-size: 15px;">${client.passport_submit_date || '-'}</div>
                    </div>
                    
                    <!-- Passport Payment Details -->
                    <div style="grid-column: span 3; margin: 16px 0; padding: 16px; background: rgba(245, 158, 11, 0.1); border-radius: 12px; border: 1px solid rgba(245, 158, 11, 0.2);">
                        <h4 style="color: #f59e0b; margin-bottom: 12px;">ðŸ’° Passport Submission Payment</h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Fee Amount</label>
                                <div style="padding: 8px 0; font-size: 15px; font-weight: 600; color: var(--accent);">â‚¹${Number(client.passport_fee || 10000).toLocaleString()}</div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Payment Mode</label>
                                <div style="padding: 8px 0; font-size: 14px;">${formatPaymentMode(client.passport_payment_mode) || '-'}</div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Payment Status</label>
                                <div style="padding: 8px 0;"><span class="status-badge status-${getPaymentStatusClass(client.passport_payment_status)}">${formatStatus(client.passport_payment_status || 'pending')}</span></div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Payment Date</label>
                                <div style="padding: 8px 0; font-size: 14px;">${client.passport_payment_date || '-'}</div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Transaction Ref</label>
                                <div style="padding: 8px 0; font-size: 14px;">${client.passport_payment_reference || '-'}</div>
                            </div>
                        </div>
                    </div>

                    <!-- Interview Details -->
                    <div style="grid-column: span 3; margin: 16px 0; padding: 16px; background: rgba(59, 130, 246, 0.1); border-radius: 12px; border: 1px solid rgba(59, 130, 246, 0.2);">
                        <h4 style="color: #3b82f6; margin-bottom: 12px;">ðŸŽ¤ Interview Details</h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Interview Date</label>
                                <div style="padding: 8px 0; font-size: 14px;">${client.interview_date || '-'}</div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Interview Time</label>
                                <div style="padding: 8px 0; font-size: 14px;">${client.interview_time || '-'}</div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Location</label>
                                <div style="padding: 8px 0; font-size: 14px;">${client.interview_location || '-'}</div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Interview Status</label>
                                <div style="padding: 8px 0;"><span class="status-badge status-${getInterviewStatusClass(client.interview_status)}">${formatStatus(client.interview_status || 'scheduled')}</span></div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Reschedule Date</label>
                                <div style="padding: 8px 0; font-size: 14px;">${client.interview_reschedule_date || '-'}</div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Interview Remarks</label>
                                <div style="padding: 8px 0; font-size: 14px;">${client.interview_remarks || '-'}</div>
                            </div>
                        </div>
                    </div>

                    ${client.interview_status === 'selected' ? `
                    <!-- Offer Letter Details -->
                    <div style="grid-column: span 3; margin: 16px 0; padding: 16px; background: rgba(16, 185, 129, 0.1); border-radius: 12px; border: 1px solid rgba(16, 185, 129, 0.2);">
                        <h4 style="color: #10b981; margin-bottom: 12px;">ðŸ“„ Offer Letter Details</h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Offer Letter Status</label>
                                <div style="padding: 8px 0;"><span class="status-badge status-${getOfferLetterStatusClass(client.offer_letter_status)}">${formatStatus(client.offer_letter_status || 'pending')}</span></div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Offer Letter Date</label>
                                <div style="padding: 8px 0; font-size: 14px;">${client.offer_letter_date || '-'}</div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Reference No</label>
                                <div style="padding: 8px 0; font-size: 14px;">${client.offer_letter_reference || '-'}</div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Employer Company</label>
                                <div style="padding: 8px 0; font-size: 14px; font-weight: 600;">${client.employer_company || '-'}</div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Offered Salary</label>
                                <div style="padding: 8px 0; font-size: 14px; font-weight: 600; color: var(--success);">${client.offered_salary || '-'}</div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Contract Duration</label>
                                <div style="padding: 8px 0; font-size: 14px;">${formatContractDuration(client.contract_duration) || '-'}</div>
                            </div>
                        </div>
                    </div>

                    <!-- Advance Payment Details -->
                    <div style="grid-column: span 3; margin: 16px 0; padding: 16px; background: rgba(245, 158, 11, 0.15); border-radius: 12px; border: 2px solid rgba(245, 158, 11, 0.3);">
                        <h4 style="color: #f59e0b; margin-bottom: 12px;">ðŸ’° Advance Payment (After Offer Letter)</h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Advance Amount</label>
                                <div style="padding: 8px 0; font-size: 18px; font-weight: 700; color: var(--accent);">â‚¹${Number(client.advance_payment || 0).toLocaleString()}</div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Payment Mode</label>
                                <div style="padding: 8px 0; font-size: 14px;">${formatPaymentMode(client.advance_payment_mode) || '-'}</div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Payment Status</label>
                                <div style="padding: 8px 0;"><span class="status-badge status-${getPaymentStatusClass(client.advance_payment_status)}">${formatStatus(client.advance_payment_status || 'pending')}</span></div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Payment Date</label>
                                <div style="padding: 8px 0; font-size: 14px;">${client.advance_payment_date || '-'}</div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Payment Time</label>
                                <div style="padding: 8px 0; font-size: 14px;">${client.advance_payment_time || '-'}</div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Transaction Ref</label>
                                <div style="padding: 8px 0; font-size: 14px;">${client.advance_payment_reference || '-'}</div>
                            </div>
                        </div>
                    </div>
                    ` : ''}

                    <div class="form-group">
                        <label class="form-label">Medical Status</label>
                        <div style="padding: 14px 0;"><span class="status-badge status-${getStatusClass(client.medical_status)}">${formatStatus(client.medical_status)}</span></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Medical Date</label>
                        <div style="padding: 14px 0; font-size: 15px;">${client.medical_date || '-'}</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Medical Report No</label>
                        <div style="padding: 14px 0; font-size: 15px;">${client.medical_report_no || '-'}</div>
                    </div>
                    
                    ${gulfDetails}
                    
                    <div class="form-group">
                        <label class="form-label">Visa Status</label>
                        <div style="padding: 14px 0;"><span class="status-badge status-${getVisaStatusClass(client.visa_status)}">${formatStatus(client.visa_status)}</span></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Visa Number</label>
                        <div style="padding: 14px 0; font-size: 15px;">${client.visa_number || '-'}</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Agreement Process</label>
                        <div style="padding: 14px 0;"><span class="status-badge status-${getStatusClass(client.agreement_process)}">${formatStatus(client.agreement_process)}</span></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Advance Payment</label>
                        <div style="padding: 14px 0; font-size: 15px; font-weight: 600; color: var(--success);">â‚¹${Number(client.advance_payment || 0).toLocaleString()}</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Full Payment</label>
                        <div style="padding: 14px 0; font-size: 15px; font-weight: 600; color: var(--success);">â‚¹${Number(client.full_payment || 0).toLocaleString()}</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Flying Date</label>
                        <div style="padding: 14px 0; font-size: 15px; font-weight: 600; color: var(--accent);">${client.flying_date || '-'}</div>
                    </div>
                    <div class="form-group full-width">
                        <label class="form-label">Remarks</label>
                        <div style="padding: 14px 0; font-size: 15px;">${client.remarks || 'No remarks'}</div>
                    </div>
                </div>
            `;

            document.getElementById('editFromViewBtn').onclick = () => {
                closeModal('viewModal');
                editClient(id);
            };

            document.getElementById('viewModal').classList.add('active');
        }

        // VFS Status class helper
        function getVfsStatusClass(status) {
            const map = {
                'not_applied': 'pending',
                'appointment_booked': 'processing',
                'documents_submitted': 'processing',
                'processing': 'processing',
                'completed': 'completed'
            };
            return map[status] || 'pending';
        }

        // Payment mode formatter
        function formatPaymentMode(mode) {
            const map = {
                'cash': 'Cash',
                'upi': 'UPI (GPay/PhonePe/Paytm)',
                'bank_transfer': 'Bank Transfer / NEFT / IMPS',
                'cheque': 'Cheque',
                'card': 'Debit/Credit Card'
            };
            return map[mode] || mode;
        }

        // Payment status class
        function getPaymentStatusClass(status) {
            const map = {
                'pending': 'pending',
                'partial': 'processing',
                'completed': 'completed'
            };
            return map[status] || 'pending';
        }

        // Interview status class
        function getInterviewStatusClass(status) {
            const map = {
                'scheduled': 'processing',
                'attended': 'processing',
                'selected': 'completed',
                'rejected': 'rejected',
                'rescheduled': 'pending',
                'absent': 'rejected'
            };
            return map[status] || 'pending';
        }

        // Offer letter status class
        function getOfferLetterStatusClass(status) {
            const map = {
                'pending': 'pending',
                'received': 'processing',
                'sent_to_client': 'processing',
                'client_accepted': 'completed'
            };
            return map[status] || 'pending';
        }

        // Format contract duration
        function formatContractDuration(duration) {
            const map = {
                '1_year': '1 Year',
                '2_years': '2 Years',
                '3_years': '3 Years',
                'unlimited': 'Unlimited'
            };
            return map[duration] || duration;
        }

        // Edit Client
        function editClient(id) {
            const client = clients.find(c => c.id === id);
            if (!client) return;

            currentEditId = id;
            const isGulf = isGulfCountry(client.country);
            const modalBody = document.getElementById('editModalBody');
            
            const gulfEditFields = `
                <div class="form-group full-width" style="margin: 20px 0; padding: 20px; background: rgba(139, 92, 246, 0.1); border-radius: 12px; border: 1px solid rgba(139, 92, 246, 0.2);">
                    <h4 style="color: #8b5cf6; margin-bottom: 16px; grid-column: span 3;">ðŸŒ™ Gulf Process Details</h4>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">MOFA Status</label>
                            <select class="form-select" id="edit_mofa_status">
                                <option value="not_applied" ${client.mofa_status === 'not_applied' ? 'selected' : ''}>Not Applied</option>
                                <option value="applied" ${client.mofa_status === 'applied' ? 'selected' : ''}>Applied</option>
                                <option value="processing" ${client.mofa_status === 'processing' ? 'selected' : ''}>Processing</option>
                                <option value="approved" ${client.mofa_status === 'approved' ? 'selected' : ''}>Approved</option>
                                <option value="rejected" ${client.mofa_status === 'rejected' ? 'selected' : ''}>Rejected</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">MOFA Number</label>
                            <input type="text" class="form-input" id="edit_mofa_number" value="${client.mofa_number || ''}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">MOFA Date</label>
                            <input type="date" class="form-input" id="edit_mofa_date" value="${client.mofa_date || ''}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">VFS Status</label>
                            <select class="form-select" id="edit_vfs_status">
                                <option value="not_applied" ${client.vfs_status === 'not_applied' ? 'selected' : ''}>Not Applied</option>
                                <option value="appointment_booked" ${client.vfs_status === 'appointment_booked' ? 'selected' : ''}>Appointment Booked</option>
                                <option value="documents_submitted" ${client.vfs_status === 'documents_submitted' ? 'selected' : ''}>Documents Submitted</option>
                                <option value="processing" ${client.vfs_status === 'processing' ? 'selected' : ''}>Processing</option>
                                <option value="completed" ${client.vfs_status === 'completed' ? 'selected' : ''}>Completed</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">VFS Appointment Date</label>
                            <input type="date" class="form-input" id="edit_vfs_appointment_date" value="${client.vfs_appointment_date || ''}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">VFS Reference No</label>
                            <input type="text" class="form-input" id="edit_vfs_reference_no" value="${client.vfs_reference_no || ''}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Takamual Status</label>
                            <select class="form-select" id="edit_takamual_status">
                                <option value="not_required" ${client.takamual_status === 'not_required' ? 'selected' : ''}>Not Required</option>
                                <option value="pending" ${client.takamual_status === 'pending' ? 'selected' : ''}>Pending</option>
                                <option value="scheduled" ${client.takamual_status === 'scheduled' ? 'selected' : ''}>Scheduled</option>
                                <option value="passed" ${client.takamual_status === 'passed' ? 'selected' : ''}>Passed</option>
                                <option value="failed" ${client.takamual_status === 'failed' ? 'selected' : ''}>Failed</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Takamual Test Date</label>
                            <input type="date" class="form-input" id="edit_takamual_date" value="${client.takamual_date || ''}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Takamual Certificate No</label>
                            <input type="text" class="form-input" id="edit_takamual_certificate_no" value="${client.takamual_certificate_no || ''}">
                        </div>
                    </div>
                </div>
            `;
            
            modalBody.innerHTML = `
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Full Name *</label>
                        <input type="text" class="form-input" id="edit_name" value="${client.name}" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Phone Number *</label>
                        <input type="tel" class="form-input" id="edit_phone" value="${client.phone}" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">District</label>
                        <input type="text" class="form-input" id="edit_district" value="${client.district}">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Job Role</label>
                        <input type="text" class="form-input" id="edit_job_role" value="${client.job_role}">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Country</label>
                        <select class="form-select" id="edit_country" onchange="toggleEditGulfModules(this.value)">
                            <option value="Maldives" ${client.country === 'Maldives' ? 'selected' : ''}>Maldives</option>
                            <option value="Saudi Arabia" ${client.country === 'Saudi Arabia' ? 'selected' : ''}>Saudi Arabia</option>
                            <option value="Dubai" ${client.country === 'Dubai' ? 'selected' : ''}>Dubai</option>
                            <option value="Singapore" ${client.country === 'Singapore' ? 'selected' : ''}>Singapore</option>
                            <option value="Malaysia" ${client.country === 'Malaysia' ? 'selected' : ''}>Malaysia</option>
                            <option value="Oman" ${client.country === 'Oman' ? 'selected' : ''}>Oman</option>
                            <option value="Qatar" ${client.country === 'Qatar' ? 'selected' : ''}>Qatar</option>
                            <option value="Kuwait" ${client.country === 'Kuwait' ? 'selected' : ''}>Kuwait</option>
                            <option value="Bahrain" ${client.country === 'Bahrain' ? 'selected' : ''}>Bahrain</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Passport No</label>
                        <input type="text" class="form-input" id="edit_passport_no" value="${client.passport_no || ''}">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Passport Submit Date</label>
                        <input type="date" class="form-input" id="edit_passport_submit_date" value="${client.passport_submit_date || ''}">
                    </div>
                </div>
                
                <!-- Passport Payment Edit Section -->
                <div style="margin: 20px 0; padding: 20px; background: rgba(245, 158, 11, 0.1); border-radius: 12px; border: 1px solid rgba(245, 158, 11, 0.2);">
                    <h4 style="color: #f59e0b; margin-bottom: 16px;">ðŸ’° Passport Submission Payment</h4>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Fee Amount (â‚¹)</label>
                            <input type="number" class="form-input" id="edit_passport_fee" value="${client.passport_fee || 10000}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Payment Mode</label>
                            <select class="form-select" id="edit_passport_payment_mode">
                                <option value="">Select Payment Mode</option>
                                <option value="cash" ${client.passport_payment_mode === 'cash' ? 'selected' : ''}>Cash</option>
                                <option value="upi" ${client.passport_payment_mode === 'upi' ? 'selected' : ''}>UPI (GPay/PhonePe/Paytm)</option>
                                <option value="bank_transfer" ${client.passport_payment_mode === 'bank_transfer' ? 'selected' : ''}>Bank Transfer / NEFT / IMPS</option>
                                <option value="cheque" ${client.passport_payment_mode === 'cheque' ? 'selected' : ''}>Cheque</option>
                                <option value="card" ${client.passport_payment_mode === 'card' ? 'selected' : ''}>Debit/Credit Card</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Payment Status</label>
                            <select class="form-select" id="edit_passport_payment_status">
                                <option value="pending" ${client.passport_payment_status === 'pending' ? 'selected' : ''}>Pending</option>
                                <option value="partial" ${client.passport_payment_status === 'partial' ? 'selected' : ''}>Partial Paid</option>
                                <option value="completed" ${client.passport_payment_status === 'completed' ? 'selected' : ''}>Completed</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Payment Date</label>
                            <input type="date" class="form-input" id="edit_passport_payment_date" value="${client.passport_payment_date || ''}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Transaction Reference</label>
                            <input type="text" class="form-input" id="edit_passport_payment_reference" value="${client.passport_payment_reference || ''}">
                        </div>
                    </div>
                </div>

                <!-- Interview Edit Section -->
                <div style="margin: 20px 0; padding: 20px; background: rgba(59, 130, 246, 0.1); border-radius: 12px; border: 1px solid rgba(59, 130, 246, 0.2);">
                    <h4 style="color: #3b82f6; margin-bottom: 16px;">ðŸŽ¤ Interview Details</h4>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Interview Date</label>
                            <input type="date" class="form-input" id="edit_interview_date" value="${client.interview_date || ''}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Interview Time</label>
                            <input type="time" class="form-input" id="edit_interview_time" value="${client.interview_time || ''}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Interview Location</label>
                            <input type="text" class="form-input" id="edit_interview_location" value="${client.interview_location || ''}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Interview Status</label>
                            <select class="form-select" id="edit_interview_status" onchange="toggleEditOfferSection(this.value)">
                                <option value="scheduled" ${client.interview_status === 'scheduled' ? 'selected' : ''}>Scheduled</option>
                                <option value="attended" ${client.interview_status === 'attended' ? 'selected' : ''}>Attended</option>
                                <option value="selected" ${client.interview_status === 'selected' ? 'selected' : ''}>Selected âœ“</option>
                                <option value="rejected" ${client.interview_status === 'rejected' ? 'selected' : ''}>Rejected âœ—</option>
                                <option value="rescheduled" ${client.interview_status === 'rescheduled' ? 'selected' : ''}>Rescheduled</option>
                                <option value="absent" ${client.interview_status === 'absent' ? 'selected' : ''}>Absent</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Reschedule Date</label>
                            <input type="date" class="form-input" id="edit_interview_reschedule_date" value="${client.interview_reschedule_date || ''}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Interview Remarks</label>
                            <input type="text" class="form-input" id="edit_interview_remarks" value="${client.interview_remarks || ''}">
                        </div>
                    </div>
                </div>

                <!-- Offer Letter & Advance Payment Edit Section -->
                <div id="editOfferSection" style="display: ${client.interview_status === 'selected' ? 'block' : 'none'}; margin: 20px 0; padding: 20px; background: rgba(16, 185, 129, 0.1); border-radius: 12px; border: 2px solid rgba(16, 185, 129, 0.3);">
                    <h4 style="color: #10b981; margin-bottom: 16px;">ðŸ“„ Offer Letter Details</h4>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Offer Letter Status</label>
                            <select class="form-select" id="edit_offer_letter_status">
                                <option value="pending" ${client.offer_letter_status === 'pending' ? 'selected' : ''}>Pending</option>
                                <option value="received" ${client.offer_letter_status === 'received' ? 'selected' : ''}>Received</option>
                                <option value="sent_to_client" ${client.offer_letter_status === 'sent_to_client' ? 'selected' : ''}>Sent to Client</option>
                                <option value="client_accepted" ${client.offer_letter_status === 'client_accepted' ? 'selected' : ''}>Client Accepted</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Offer Letter Date</label>
                            <input type="date" class="form-input" id="edit_offer_letter_date" value="${client.offer_letter_date || ''}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Reference No</label>
                            <input type="text" class="form-input" id="edit_offer_letter_reference" value="${client.offer_letter_reference || ''}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Employer Company</label>
                            <input type="text" class="form-input" id="edit_employer_company" value="${client.employer_company || ''}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Offered Salary</label>
                            <input type="text" class="form-input" id="edit_offered_salary" value="${client.offered_salary || ''}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Contract Duration</label>
                            <select class="form-select" id="edit_contract_duration">
                                <option value="">Select Duration</option>
                                <option value="1_year" ${client.contract_duration === '1_year' ? 'selected' : ''}>1 Year</option>
                                <option value="2_years" ${client.contract_duration === '2_years' ? 'selected' : ''}>2 Years</option>
                                <option value="3_years" ${client.contract_duration === '3_years' ? 'selected' : ''}>3 Years</option>
                                <option value="unlimited" ${client.contract_duration === 'unlimited' ? 'selected' : ''}>Unlimited</option>
                            </select>
                        </div>
                    </div>
                    
                    <h4 style="color: #f59e0b; margin: 20px 0 16px 0;">ðŸ’° Advance Payment</h4>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Advance Amount (â‚¹)</label>
                            <input type="number" class="form-input" id="edit_advance_payment" value="${client.advance_payment || ''}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Payment Mode</label>
                            <select class="form-select" id="edit_advance_payment_mode">
                                <option value="">Select Mode</option>
                                <option value="cash" ${client.advance_payment_mode === 'cash' ? 'selected' : ''}>Cash</option>
                                <option value="upi" ${client.advance_payment_mode === 'upi' ? 'selected' : ''}>UPI (GPay/PhonePe/Paytm)</option>
                                <option value="bank_transfer" ${client.advance_payment_mode === 'bank_transfer' ? 'selected' : ''}>Bank Transfer</option>
                                <option value="cheque" ${client.advance_payment_mode === 'cheque' ? 'selected' : ''}>Cheque</option>
                                <option value="card" ${client.advance_payment_mode === 'card' ? 'selected' : ''}>Debit/Credit Card</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Payment Status</label>
                            <select class="form-select" id="edit_advance_payment_status">
                                <option value="pending" ${client.advance_payment_status === 'pending' ? 'selected' : ''}>Pending</option>
                                <option value="partial" ${client.advance_payment_status === 'partial' ? 'selected' : ''}>Partial Paid</option>
                                <option value="completed" ${client.advance_payment_status === 'completed' ? 'selected' : ''}>Completed</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Payment Date</label>
                            <input type="date" class="form-input" id="edit_advance_payment_date" value="${client.advance_payment_date || ''}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Payment Time</label>
                            <input type="time" class="form-input" id="edit_advance_payment_time" value="${client.advance_payment_time || ''}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Transaction Ref</label>
                            <input type="text" class="form-input" id="edit_advance_payment_reference" value="${client.advance_payment_reference || ''}">
                        </div>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Medical Status</label>
                        <select class="form-select" id="edit_medical_status">
                            <option value="pending" ${client.medical_status === 'pending' ? 'selected' : ''}>Pending</option>
                            <option value="scheduled" ${client.medical_status === 'scheduled' ? 'selected' : ''}>Scheduled</option>
                            <option value="fit" ${client.medical_status === 'fit' ? 'selected' : ''}>Fit</option>
                            <option value="unfit" ${client.medical_status === 'unfit' ? 'selected' : ''}>Unfit</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Medical Date</label>
                        <input type="date" class="form-input" id="edit_medical_date" value="${client.medical_date || ''}">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Medical Report No</label>
                        <input type="text" class="form-input" id="edit_medical_report_no" value="${client.medical_report_no || ''}">
                    </div>
                </div>
                
                <div id="editGulfModules" style="display: ${isGulf ? 'block' : 'none'};">
                    ${gulfEditFields}
                </div>
                
                <div class="form-grid" style="margin-top: 20px;">
                    <div class="form-group">
                        <label class="form-label">Visa Status</label>
                        <select class="form-select" id="edit_visa_status">
                            <option value="not_applied" ${client.visa_status === 'not_applied' ? 'selected' : ''}>Not Applied</option>
                            <option value="applied" ${client.visa_status === 'applied' ? 'selected' : ''}>Applied</option>
                            <option value="processing" ${client.visa_status === 'processing' ? 'selected' : ''}>Processing</option>
                            <option value="approved" ${client.visa_status === 'approved' ? 'selected' : ''}>Approved</option>
                            <option value="rejected" ${client.visa_status === 'rejected' ? 'selected' : ''}>Rejected</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Visa Number</label>
                        <input type="text" class="form-input" id="edit_visa_number" value="${client.visa_number || ''}">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Visa Expiry Date</label>
                        <input type="date" class="form-input" id="edit_visa_expiry_date" value="${client.visa_expiry_date || ''}">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Agreement Process</label>
                        <select class="form-select" id="edit_agreement_process">
                            <option value="pending" ${client.agreement_process === 'pending' ? 'selected' : ''}>Pending</option>
                            <option value="in_progress" ${client.agreement_process === 'in_progress' ? 'selected' : ''}>In Progress</option>
                            <option value="completed" ${client.agreement_process === 'completed' ? 'selected' : ''}>Completed</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Agreement Date</label>
                        <input type="date" class="form-input" id="edit_agreement_date" value="${client.agreement_date || ''}">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Agreement Number</label>
                        <input type="text" class="form-input" id="edit_agreement_number" value="${client.agreement_number || ''}">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Advance Payment (â‚¹)</label>
                        <input type="number" class="form-input" id="edit_advance_payment" value="${client.advance_payment || 0}">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Full Payment (â‚¹)</label>
                        <input type="number" class="form-input" id="edit_full_payment" value="${client.full_payment || 0}">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Flying Date</label>
                        <input type="date" class="form-input" id="edit_flying_date" value="${client.flying_date || ''}">
                    </div>
                    <div class="form-group full-width">
                        <label class="form-label">Remarks</label>
                        <textarea class="form-textarea" id="edit_remarks">${client.remarks || ''}</textarea>
                    </div>
                </div>
            `;

            document.getElementById('editModal').classList.add('active');
        }

        // Toggle Gulf modules in edit modal
        function toggleEditGulfModules(country) {
            const gulfModules = document.getElementById('editGulfModules');
            if (gulfModules) {
                gulfModules.style.display = isGulfCountry(country) ? 'block' : 'none';
            }
        }

        // Update Client - API
        async function updateClient() {
            const index = clients.findIndex(c => c.id === currentEditId);
            if (index === -1) return;

            const country = document.getElementById('edit_country').value;
            const isGulf = isGulfCountry(country);
            const interviewStatus = document.getElementById('edit_interview_status').value;
            const isSelected = interviewStatus === 'selected';

            const updatedData = {
                ...clients[index],
                name: document.getElementById('edit_name').value,
                phone: document.getElementById('edit_phone').value,
                district: document.getElementById('edit_district').value,
                job_role: document.getElementById('edit_job_role').value,
                country: country,
                passport_no: document.getElementById('edit_passport_no').value,
                passport_submit_date: document.getElementById('edit_passport_submit_date').value,
                // Passport payment fields
                passport_fee: document.getElementById('edit_passport_fee').value,
                passport_payment_mode: document.getElementById('edit_passport_payment_mode').value,
                passport_payment_status: document.getElementById('edit_passport_payment_status').value,
                passport_payment_date: document.getElementById('edit_passport_payment_date').value,
                passport_payment_reference: document.getElementById('edit_passport_payment_reference').value,
                // Interview fields
                interview_date: document.getElementById('edit_interview_date').value,
                interview_time: document.getElementById('edit_interview_time').value,
                interview_location: document.getElementById('edit_interview_location').value,
                interview_status: interviewStatus,
                interview_reschedule_date: document.getElementById('edit_interview_reschedule_date').value,
                interview_remarks: document.getElementById('edit_interview_remarks').value,
                // Offer Letter fields (only save if selected)
                offer_letter_status: isSelected ? document.getElementById('edit_offer_letter_status')?.value : clients[index].offer_letter_status,
                offer_letter_date: isSelected ? document.getElementById('edit_offer_letter_date')?.value : clients[index].offer_letter_date,
                offer_letter_reference: isSelected ? document.getElementById('edit_offer_letter_reference')?.value : clients[index].offer_letter_reference,
                employer_company: isSelected ? document.getElementById('edit_employer_company')?.value : clients[index].employer_company,
                offered_salary: isSelected ? document.getElementById('edit_offered_salary')?.value : clients[index].offered_salary,
                contract_duration: isSelected ? document.getElementById('edit_contract_duration')?.value : clients[index].contract_duration,
                // Advance Payment fields (only save if selected)
                advance_payment: isSelected ? document.getElementById('edit_advance_payment')?.value : clients[index].advance_payment,
                advance_payment_mode: isSelected ? document.getElementById('edit_advance_payment_mode')?.value : clients[index].advance_payment_mode,
                advance_payment_status: isSelected ? document.getElementById('edit_advance_payment_status')?.value : clients[index].advance_payment_status,
                advance_payment_date: isSelected ? document.getElementById('edit_advance_payment_date')?.value : clients[index].advance_payment_date,
                advance_payment_time: isSelected ? document.getElementById('edit_advance_payment_time')?.value : clients[index].advance_payment_time,
                advance_payment_reference: isSelected ? document.getElementById('edit_advance_payment_reference')?.value : clients[index].advance_payment_reference,
                // Medical fields
                medical_status: document.getElementById('edit_medical_status').value,
                medical_date: document.getElementById('edit_medical_date').value,
                medical_report_no: document.getElementById('edit_medical_report_no').value,
                // Gulf specific fields (only save if Gulf country)
                mofa_status: isGulf ? document.getElementById('edit_mofa_status')?.value : clients[index].mofa_status,
                mofa_number: isGulf ? document.getElementById('edit_mofa_number')?.value : clients[index].mofa_number,
                mofa_date: isGulf ? document.getElementById('edit_mofa_date')?.value : clients[index].mofa_date,
                vfs_status: isGulf ? document.getElementById('edit_vfs_status')?.value : clients[index].vfs_status,
                vfs_appointment_date: isGulf ? document.getElementById('edit_vfs_appointment_date')?.value : clients[index].vfs_appointment_date,
                vfs_reference_no: isGulf ? document.getElementById('edit_vfs_reference_no')?.value : clients[index].vfs_reference_no,
                takamual_status: isGulf ? document.getElementById('edit_takamual_status')?.value : clients[index].takamual_status,
                takamual_date: isGulf ? document.getElementById('edit_takamual_date')?.value : clients[index].takamual_date,
                takamual_certificate_no: isGulf ? document.getElementById('edit_takamual_certificate_no')?.value : clients[index].takamual_certificate_no,
                // Visa and Agreement
                visa_status: document.getElementById('edit_visa_status').value,
                visa_number: document.getElementById('edit_visa_number').value,
                visa_expiry_date: document.getElementById('edit_visa_expiry_date').value,
                agreement_process: document.getElementById('edit_agreement_process').value,
                agreement_date: document.getElementById('edit_agreement_date').value,
                agreement_number: document.getElementById('edit_agreement_number').value,
                // Final Payment
                full_payment: document.getElementById('edit_full_payment').value,
                full_payment_mode: document.getElementById('edit_full_payment_mode')?.value,
                full_payment_date: document.getElementById('edit_full_payment_date')?.value,
                flying_date: document.getElementById('edit_flying_date').value,
                flight_details: document.getElementById('edit_flight_details')?.value,
                ticket_status: document.getElementById('edit_ticket_status')?.value,
                remarks: document.getElementById('edit_remarks').value
            };

            try {
                await fetch(`/api/clients/${currentEditId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updatedData)
                });
                await loadClients();
                closeModal('editModal');
                showToast('Client updated successfully!', 'success');
            } catch (error) {
                showToast('Error updating client!', 'error');
            }
        }

        // Delete Client
        async function deleteClient(id) {
            if (!confirm('Are you sure you want to delete this client?')) return;
            try {
                await fetch(`/api/clients/${id}`, { method: 'DELETE' });
                await loadClients();
                showToast('Client deleted successfully!', 'success');
            } catch (error) {
                showToast('Error deleting client!', 'error');
            }
        }

        // Filter Clients
        function filterClients(filter, btn) {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            let filtered = clients;
            switch(filter) {
                case 'interview_pending':
                    filtered = clients.filter(c => c.interview_status === 'pending' || c.interview_status === 'scheduled');
                    break;
                case 'interview_passed':
                    filtered = clients.filter(c => c.interview_status === 'passed' || c.interview_status === 'selected');
                    break;
                case 'visa_approved':
                    filtered = clients.filter(c => c.visa_status === 'approved');
                    break;
                case 'ready_to_fly':
                    filtered = clients.filter(c => c.visa_status === 'approved' && c.flying_date);
                    break;
                case 'advance_paid':
                    filtered = clients.filter(c => Number(c.advance_payment || 0) > 0);
                    break;
                case 'full_paid':
                    filtered = clients.filter(c => Number(c.full_payment || 0) > 0);
                    break;
                case 'payment_pending':
                    filtered = clients.filter(c => Number(c.advance_payment || 0) === 0 && Number(c.full_payment || 0) === 0);
                    break;
            }
            renderTables(filtered);
        }

        // Search Clients
        function searchClients() {
            const query = document.getElementById('globalSearch').value.toLowerCase();
            if (!query) {
                renderTables();
                return;
            }

            const filtered = clients.filter(c => 
                c.name.toLowerCase().includes(query) ||
                c.phone.includes(query) ||
                c.district.toLowerCase().includes(query) ||
                c.country.toLowerCase().includes(query)
            );
            renderTables(filtered);
        }

        // Export to CSV
        function exportToCSV() {
            if (clients.length === 0) {
                showToast('No data to export!', 'error');
                return;
            }

            const headers = [
                'Name', 'Phone', 'District', 'Job Role', 'Country', 'Passport No', 'Passport Submit Date',
                'Passport Fee', 'Payment Mode', 'Payment Status', 'Payment Date', 'Transaction Ref',
                'Interview Date', 'Interview Time', 'Interview Location', 'Interview Status', 'Reschedule Date', 'Interview Remarks',
                'Offer Letter Status', 'Offer Letter Date', 'Offer Letter Ref', 'Employer Company', 'Offered Salary', 'Contract Duration',
                'Advance Amount', 'Advance Payment Mode', 'Advance Payment Status', 'Advance Payment Date', 'Advance Payment Time', 'Advance Payment Ref',
                'Medical Status', 'Medical Date', 'Medical Report No',
                'MOFA Status', 'MOFA Number', 'MOFA Date',
                'VFS Status', 'VFS Appointment Date', 'VFS Reference No',
                'Takamual Status', 'Takamual Date', 'Takamual Certificate No',
                'Visa Status', 'Visa Number', 'Visa Expiry Date',
                'Agreement Process', 'Agreement Date', 'Agreement Number',
                'Full Payment', 'Full Payment Mode', 'Full Payment Date', 'Flying Date', 'Flight Details', 'Ticket Status', 'Remarks'
            ];
            const rows = clients.map(c => [
                c.name, c.phone, c.district, c.job_role, c.country, c.passport_no, c.passport_submit_date,
                c.passport_fee, c.passport_payment_mode, c.passport_payment_status, c.passport_payment_date, c.passport_payment_reference,
                c.interview_date, c.interview_time, c.interview_location, c.interview_status, c.interview_reschedule_date, c.interview_remarks,
                c.offer_letter_status, c.offer_letter_date, c.offer_letter_reference, c.employer_company, c.offered_salary, c.contract_duration,
                c.advance_payment, c.advance_payment_mode, c.advance_payment_status, c.advance_payment_date, c.advance_payment_time, c.advance_payment_reference,
                c.medical_status, c.medical_date, c.medical_report_no,
                c.mofa_status, c.mofa_number, c.mofa_date,
                c.vfs_status, c.vfs_appointment_date, c.vfs_reference_no,
                c.takamual_status, c.takamual_date, c.takamual_certificate_no,
                c.visa_status, c.visa_number, c.visa_expiry_date,
                c.agreement_process, c.agreement_date, c.agreement_number,
                c.full_payment, c.full_payment_mode, c.full_payment_date, c.flying_date, c.flight_details, c.ticket_status, c.remarks
            ]);

            let csv = headers.join(',') + '\n';
            rows.forEach(row => {
                csv += row.map(cell => `"${cell || ''}"`).join(',') + '\n';
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `clients_export_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
            showToast('Data exported successfully!', 'success');
        }

        // Export to Excel - Single Sheet with Important Data Only
        function exportToExcel() {
            if (clients.length === 0) {
                showToast('No data to export!', 'error');
                return;
            }

            const wb = XLSX.utils.book_new();

            // Single Sheet with all important data in separate columns
            const exportData = clients.map((c, index) => {
                const penaltyInfo = calculatePenalty(c);
                const totalPaid = (c.passport_submitted_by === 'agency' ? Number(c.passport_fee || 0) : 0) + 
                                 Number(c.advance_payment || 0) + 
                                 Number(c.full_payment || 0);
                
                return {
                    // Client Info
                    'S.No': index + 1,
                    'Name': c.name || '',
                    'Phone': c.phone || '',
                    'District': c.district || '',
                    'Job Role': c.job_role || '',
                    'Country': c.country || '',
                    'Passport No': c.passport_no || '',
                    
                    // Payment Process
                    'Passport Fee (â‚¹)': c.passport_submitted_by === 'agency' ? Number(c.passport_fee || 0) : 0,
                    'Passport Fee Status': formatStatus(c.passport_payment_status || 'pending'),
                    'Advance (â‚¹)': Number(c.advance_payment || 0),
                    'Advance Status': formatStatus(c.advance_payment_status || 'pending'),
                    'Full Payment (â‚¹)': Number(c.full_payment || 0),
                    'Total Paid (â‚¹)': totalPaid,
                    
                    // Visa Status
                    'Medical Status': formatStatus(c.medical_status || 'pending'),
                    'MOFA Status': isGulfCountry(c.country) ? formatStatus(c.mofa_status || 'not_applied') : 'N/A',
                    'VFS Status': isGulfCountry(c.country) ? formatStatus(c.vfs_status || 'not_applied') : 'N/A',
                    'Takamual Status': isGulfCountry(c.country) ? formatStatus(c.takamual_status || 'not_required') : 'N/A',
                    'Visa Status': formatStatus(c.visa_status || 'not_applied'),
                    'Visa Number': c.visa_number || '-',
                    
                    // Agreement Process
                    'Agreement Status': formatStatus(c.agreement_process || 'not_created'),
                    'Client Signed': c.client_signed === 'yes' ? 'Yes' : 'No',
                    'Agreement No': c.agreement_number || '-',
                    
                    // Penalty Rule
                    'Penalty Applicable': penaltyInfo.applicable ? 'Yes' : 'No',
                    'Penalty Reason': penaltyInfo.reason,
                    'Penalty (â‚¹)': penaltyInfo.amount,
                    'Refund (â‚¹)': penaltyInfo.refund,
                    
                    // Status
                    'Flying Date': c.flying_date || '-',
                    'Current Status': getOverallStatus(c)
                };
            });

            const ws = XLSX.utils.json_to_sheet(exportData);
            
            // Set column widths
            ws['!cols'] = [
                { wch: 5 },   // S.No
                { wch: 18 },  // Name
                { wch: 12 },  // Phone
                { wch: 12 },  // District
                { wch: 15 },  // Job Role
                { wch: 12 },  // Country
                { wch: 12 },  // Passport No
                { wch: 12 },  // Passport Fee
                { wch: 15 },  // Passport Fee Status
                { wch: 12 },  // Advance
                { wch: 15 },  // Advance Status
                { wch: 12 },  // Full Payment
                { wch: 12 },  // Total Paid
                { wch: 12 },  // Medical Status
                { wch: 12 },  // MOFA Status
                { wch: 12 },  // VFS Status
                { wch: 12 },  // Takamual Status
                { wch: 12 },  // Visa Status
                { wch: 15 },  // Visa Number
                { wch: 15 },  // Agreement Status
                { wch: 12 },  // Client Signed
                { wch: 15 },  // Agreement No
                { wch: 12 },  // Penalty Applicable
                { wch: 30 },  // Penalty Reason
                { wch: 12 },  // Penalty
                { wch: 12 },  // Refund
                { wch: 12 },  // Flying Date
                { wch: 15 }   // Current Status
            ];

            XLSX.utils.book_append_sheet(wb, ws, 'Client Data');

            const fileName = `Global_Service_Clients_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
            showToast('Excel exported successfully!', 'success');
        }

        // Helper: Get Overall Status
        function getOverallStatus(client) {
            if (client.flying_date && client.visa_status === 'approved') return 'Ready to Fly';
            if (client.visa_status === 'approved') return 'Visa Approved';
            if (client.visa_status === 'processing') return 'Visa Processing';
            if (client.interview_status === 'selected') return 'Interview Selected';
            if (client.interview_status === 'rejected') return 'Interview Rejected';
            if (client.interview_status === 'scheduled' || client.interview_status === 'attended') return 'Interview Pending';
            return 'New Client';
        }

        // Helper: Check if payment is complete
        function isPaymentComplete(client) {
            const passportPaid = client.passport_submitted_by !== 'agency' || client.passport_payment_status === 'completed';
            const advancePaid = client.advance_payment_status === 'completed' || Number(client.advance_payment || 0) === 0;
            return passportPaid && advancePaid;
        }

        // Helper: Calculate Penalty
        function calculatePenalty(client) {
            const totalPaid = (client.passport_submitted_by === 'agency' ? Number(client.passport_fee || 0) : 0) + 
                             Number(client.advance_payment || 0) + 
                             Number(client.full_payment || 0);
            
            if (client.interview_status === 'rejected') {
                return {
                    applicable: true,
                    reason: 'Interview Rejected - Processing fee non-refundable',
                    amount: client.passport_submitted_by === 'agency' ? Number(client.passport_fee || 0) : 5000,
                    refund: totalPaid - (client.passport_submitted_by === 'agency' ? Number(client.passport_fee || 0) : 5000)
                };
            }
            if (client.interview_status === 'absent') {
                return {
                    applicable: true,
                    reason: 'Interview Absent - 50% penalty',
                    amount: Math.round(totalPaid * 0.5),
                    refund: Math.round(totalPaid * 0.5)
                };
            }
            if (client.visa_status === 'rejected') {
                return {
                    applicable: true,
                    reason: 'Visa Rejected - Processing charges applicable',
                    amount: 15000,
                    refund: totalPaid - 15000 > 0 ? totalPaid - 15000 : 0
                };
            }
            if (client.medical_status === 'unfit') {
                return {
                    applicable: true,
                    reason: 'Medical Unfit - Partial refund',
                    amount: 10000,
                    refund: totalPaid - 10000 > 0 ? totalPaid - 10000 : 0
                };
            }
            if (client.client_signed === 'yes' && client.visa_status !== 'approved' && client.remarks?.toLowerCase().includes('cancel')) {
                return {
                    applicable: true,
                    reason: 'Client Cancelled after Agreement - 25% penalty',
                    amount: Math.round(totalPaid * 0.25),
                    refund: Math.round(totalPaid * 0.75)
                };
            }
            
            return {
                applicable: false,
                reason: 'No penalty',
                amount: 0,
                refund: 0
            };
        }

        // Export Single Client
        function exportSingleClientToExcel(clientId) {
            const client = clients.find(c => c.id === clientId);
            if (!client) {
                showToast('Client not found!', 'error');
                return;
            }

            const wb = XLSX.utils.book_new();
            const penaltyInfo = calculatePenalty(client);
            const totalPaid = (client.passport_submitted_by === 'agency' ? Number(client.passport_fee || 0) : 0) + 
                             Number(client.advance_payment || 0) + 
                             Number(client.full_payment || 0);

            const clientData = [[
                1,
                client.name || '',
                client.phone || '',
                client.district || '',
                client.job_role || '',
                client.country || '',
                client.passport_no || '',
                client.passport_submitted_by === 'agency' ? Number(client.passport_fee || 0) : 0,
                formatStatus(client.passport_payment_status || 'pending'),
                Number(client.advance_payment || 0),
                formatStatus(client.advance_payment_status || 'pending'),
                Number(client.full_payment || 0),
                totalPaid,
                formatStatus(client.medical_status || 'pending'),
                isGulfCountry(client.country) ? formatStatus(client.mofa_status || 'not_applied') : 'N/A',
                isGulfCountry(client.country) ? formatStatus(client.vfs_status || 'not_applied') : 'N/A',
                isGulfCountry(client.country) ? formatStatus(client.takamual_status || 'not_required') : 'N/A',
                formatStatus(client.visa_status || 'not_applied'),
                client.visa_number || '-',
                formatStatus(client.agreement_process || 'not_created'),
                client.client_signed === 'yes' ? 'Yes' : 'No',
                client.agreement_number || '-',
                penaltyInfo.applicable ? 'Yes' : 'No',
                penaltyInfo.reason,
                penaltyInfo.amount,
                penaltyInfo.refund,
                client.flying_date || '-',
                getOverallStatus(client)
            ]];

            const headers = ['S.No', 'Name', 'Phone', 'District', 'Job Role', 'Country', 'Passport No',
                'Passport Fee (â‚¹)', 'Passport Fee Status', 'Advance (â‚¹)', 'Advance Status', 'Full Payment (â‚¹)', 'Total Paid (â‚¹)',
                'Medical Status', 'MOFA Status', 'VFS Status', 'Takamual Status', 'Visa Status', 'Visa Number',
                'Agreement Status', 'Client Signed', 'Agreement No',
                'Penalty Applicable', 'Penalty Reason', 'Penalty (â‚¹)', 'Refund (â‚¹)',
                'Flying Date', 'Current Status'];

            const ws = XLSX.utils.aoa_to_sheet([headers, ...clientData]);
            XLSX.utils.book_append_sheet(wb, ws, 'Client Data');

            const fileName = `Client_${client.name.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
            showToast(`${client.name}'s data exported!`, 'success');
        }

        // Search in Clients List
        function searchClientsInList() {
            const query = document.getElementById('clientSearch').value.toLowerCase();
            if (!query) {
                renderTables();
                return;
            }
            const filtered = clients.filter(c => 
                c.name.toLowerCase().includes(query) ||
                c.phone.includes(query) ||
                c.district?.toLowerCase().includes(query) ||
                c.country?.toLowerCase().includes(query) ||
                c.passport_no?.toLowerCase().includes(query)
            );
            renderTables(filtered);
        }

        async function clearAllData() {
            if (!confirm('Are you sure you want to delete ALL client data?')) return;
            if (!confirm('This will permanently delete all records. Continue?')) return;
            try {
                await fetch('/api/clients/clear', { method: 'DELETE' });
                await loadClients();
                showToast('All data cleared!', 'success');
            } catch (error) {
                showToast('Error clearing data!', 'error');
            }
        }

        // Modal Functions
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Open Agreement Modal
        function openAgreementModal() {
            // Populate client dropdown
            const select = document.getElementById('agreementClientSelect');
            select.innerHTML = '<option value="">-- Select Client --</option>';
            clients.forEach(client => {
                select.innerHTML += `<option value="${client.id}">${client.name} - ${client.phone}</option>`;
            });
            
            // Set today's date
            document.getElementById('agr_date').value = new Date().toISOString().split('T')[0];
            document.getElementById('agr_number').value = `AGR-${new Date().getFullYear()}-${String(clients.length + 1).padStart(3, '0')}`;
            
            document.getElementById('agreementModal').classList.add('active');
        }

        // Load client data into agreement
        function loadClientForAgreement() {
            const clientId = document.getElementById('agreementClientSelect').value;
            if (!clientId) return;
            
            const client = clients.find(c => c.id == clientId);
            if (!client) return;
            
            // Fill agreement preview with client data
            document.getElementById('preview_agr_no').textContent = document.getElementById('agr_number').value;
            document.getElementById('preview_date').textContent = document.getElementById('agr_date').value;
            document.getElementById('preview_name').textContent = client.name;
            document.getElementById('preview_phone').textContent = client.phone;
            document.getElementById('preview_district').textContent = client.district || '-';
            document.getElementById('preview_passport').textContent = client.passport_no || '-';
            document.getElementById('preview_country').textContent = client.country || '-';
            document.getElementById('preview_job').textContent = client.job_role || '-';
            document.getElementById('preview_employer').textContent = client.employer_company || '-';
            document.getElementById('preview_salary').textContent = client.offered_salary || '-';
            document.getElementById('preview_duration').textContent = formatContractDuration(client.contract_duration) || '-';
            document.getElementById('preview_advance').textContent = `â‚¹ ${Number(client.advance_payment || 0).toLocaleString()}`;
            document.getElementById('preview_client_sign').textContent = client.name;
            document.getElementById('preview_witness').textContent = client.witness_name || '______________';
            
            // Calculate total and balance (you can customize this)
            const total = Number(client.advance_payment || 0) + Number(client.full_payment || 0);
            document.getElementById('preview_total_fee').textContent = `â‚¹ ${total.toLocaleString()}`;
            document.getElementById('preview_balance').textContent = `â‚¹ ${Number(client.full_payment || 0).toLocaleString()}`;
        }

        // Download Agreement as PDF
        function downloadAgreementPDF() {
            const element = document.getElementById('agreementPreview');
            const clientSelect = document.getElementById('agreementClientSelect');
            const selectedOption = clientSelect.options[clientSelect.selectedIndex];
            const clientName = selectedOption ? selectedOption.text.split(' - ')[0] : 'Client';
            
            // Use html2pdf library (we'll add it via CDN)
            const opt = {
                margin: 10,
                filename: `Agreement_${clientName.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            
            // Check if html2pdf is loaded
            if (typeof html2pdf !== 'undefined') {
                html2pdf().set(opt).from(element).save();
                showToast('Agreement PDF downloaded!', 'success');
            } else {
                // Fallback: Open print dialog
                const printWindow = window.open('', '_blank');
                printWindow.document.write(`
                    <html>
                    <head>
                        <title>Agreement - ${clientName}</title>
                        <style>
                            body { font-family: 'Times New Roman', serif; padding: 20px; }
                            @media print { body { padding: 0; } }
                        </style>
                    </head>
                    <body>${element.innerHTML}</body>
                    </html>
                `);
                printWindow.document.close();
                printWindow.print();
                showToast('Print dialog opened. Save as PDF!', 'success');
            }
        }

        // Toast Notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            
            toast.className = `toast ${type}`;
            toastMessage.textContent = message;
            toast.classList.add('show');

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Reset Form
        function resetForm() {
            document.getElementById('clientForm').reset();
        }

        // Close modal on outside click
        document.querySelectorAll('.modal-overlay').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });
        });

        // ==================== REPORTS FUNCTIONS ====================
        
        let countryChart, visaChart, interviewChart, paymentChart, monthlyChart, revenueChart;
        
        function refreshReports() {
            generateReports();
            showToast('Reports refreshed!', 'success');
        }
        
        function generateReports() {
            if (clients.length === 0) {
                document.getElementById('reportTotalClients').textContent = '0';
                document.getElementById('reportTotalRevenue').textContent = 'â‚¹0';
                document.getElementById('reportSuccessRate').textContent = '0%';
                document.getElementById('reportCountries').textContent = '0';
                clearAllCharts();
                return;
            }
            
            // Calculate stats
            const totalClients = clients.length;
            const totalRevenue = clients.reduce((sum, c) => {
                return sum + Number(c.advance_payment || 0) + Number(c.full_payment || 0) + 
                       (c.passport_submitted_by === 'agency' ? Number(c.passport_fee || 0) : 0);
            }, 0);
            const visaApproved = clients.filter(c => c.visa_status === 'approved').length;
            const successRate = totalClients > 0 ? Math.round((visaApproved / totalClients) * 100) : 0;
            const countries = [...new Set(clients.map(c => c.country).filter(c => c))];
            
            // Update stats
            document.getElementById('reportTotalClients').textContent = totalClients;
            document.getElementById('reportTotalRevenue').textContent = 'â‚¹' + totalRevenue.toLocaleString();
            document.getElementById('reportSuccessRate').textContent = successRate + '%';
            document.getElementById('reportCountries').textContent = countries.length;
            
            // Generate Charts
            generateCountryPieChart();
            generateVisaPieChart();
            generateInterviewPieChart();
            generatePaymentPieChart();
            generateMonthlyBarChart();
            generateRevenueBarChart();
            generateCountryReportTable();
        }
        
        function clearAllCharts() {
            if (countryChart) countryChart.destroy();
            if (visaChart) visaChart.destroy();
            if (interviewChart) interviewChart.destroy();
            if (paymentChart) paymentChart.destroy();
            if (monthlyChart) monthlyChart.destroy();
            if (revenueChart) revenueChart.destroy();
        }
        
        function generateCountryPieChart() {
            const ctx = document.getElementById('countryPieChart');
            if (!ctx) return;
            
            const countryCounts = {};
            clients.forEach(c => {
                const country = c.country || 'Unknown';
                countryCounts[country] = (countryCounts[country] || 0) + 1;
            });
            
            const labels = Object.keys(countryCounts);
            const data = Object.values(countryCounts);
            const colors = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899', '#06b6d4', '#84cc16'];
            
            if (countryChart) countryChart.destroy();
            
            countryChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors.slice(0, labels.length),
                        borderColor: '#1e293b',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: { color: '#94a3b8', padding: 15, font: { size: 12 } }
                        }
                    }
                }
            });
        }
        
        function generateVisaPieChart() {
            const ctx = document.getElementById('visaPieChart');
            if (!ctx) return;
            
            const visaCounts = {
                'Approved': clients.filter(c => c.visa_status === 'approved').length,
                'Applied': clients.filter(c => c.visa_status === 'applied').length,
                'Processing': clients.filter(c => c.visa_status === 'processing').length,
                'Not Applied': clients.filter(c => !c.visa_status || c.visa_status === 'not_applied').length,
                'Rejected': clients.filter(c => c.visa_status === 'rejected').length
            };
            
            const filtered = Object.entries(visaCounts).filter(([k, v]) => v > 0);
            const labels = filtered.map(([k]) => k);
            const data = filtered.map(([k, v]) => v);
            const colors = ['#10b981', '#3b82f6', '#f59e0b', '#64748b', '#ef4444'];
            
            if (visaChart) visaChart.destroy();
            
            visaChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors.slice(0, labels.length),
                        borderColor: '#1e293b',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: { color: '#94a3b8', padding: 15, font: { size: 12 } }
                        }
                    }
                }
            });
        }
        
        function generateInterviewPieChart() {
            const ctx = document.getElementById('interviewPieChart');
            if (!ctx) return;
            
            const interviewCounts = {
                'Selected': clients.filter(c => c.interview_status === 'selected' || c.interview_status === 'passed').length,
                'Scheduled': clients.filter(c => c.interview_status === 'scheduled').length,
                'Pending': clients.filter(c => !c.interview_status || c.interview_status === 'pending').length,
                'Rejected': clients.filter(c => c.interview_status === 'rejected' || c.interview_status === 'failed').length
            };
            
            const filtered = Object.entries(interviewCounts).filter(([k, v]) => v > 0);
            const labels = filtered.map(([k]) => k);
            const data = filtered.map(([k, v]) => v);
            const colors = ['#10b981', '#3b82f6', '#f59e0b', '#ef4444'];
            
            if (interviewChart) interviewChart.destroy();
            
            interviewChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors.slice(0, labels.length),
                        borderColor: '#1e293b',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: { color: '#94a3b8', padding: 15, font: { size: 12 } }
                        }
                    }
                }
            });
        }
        
        function generatePaymentPieChart() {
            const ctx = document.getElementById('paymentPieChart');
            if (!ctx) return;
            
            const totalAdvance = clients.reduce((sum, c) => sum + Number(c.advance_payment || 0), 0);
            const totalFull = clients.reduce((sum, c) => sum + Number(c.full_payment || 0), 0);
            const totalPassport = clients.reduce((sum, c) => {
                return sum + (c.passport_submitted_by === 'agency' ? Number(c.passport_fee || 0) : 0);
            }, 0);
            
            const paymentData = {
                'Advance Payment': totalAdvance,
                'Full Payment': totalFull,
                'Passport Fee': totalPassport
            };
            
            const filtered = Object.entries(paymentData).filter(([k, v]) => v > 0);
            const labels = filtered.map(([k]) => k);
            const data = filtered.map(([k, v]) => v);
            const colors = ['#f59e0b', '#10b981', '#8b5cf6'];
            
            if (paymentChart) paymentChart.destroy();
            
            if (data.length === 0) {
                return;
            }
            
            paymentChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors.slice(0, labels.length),
                        borderColor: '#1e293b',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: { color: '#94a3b8', padding: 15, font: { size: 12 } }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': â‚¹' + context.raw.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function generateMonthlyBarChart() {
            const ctx = document.getElementById('monthlyBarChart');
            if (!ctx) return;
            
            const months = [];
            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const now = new Date();
            
            for (let i = 5; i >= 0; i--) {
                const d = new Date(now.getFullYear(), now.getMonth() - i, 1);
                months.push({
                    label: monthNames[d.getMonth()] + ' ' + d.getFullYear(),
                    month: d.getMonth(),
                    year: d.getFullYear()
                });
            }
            
            const monthlyCounts = months.map(m => {
                return clients.filter(c => {
                    if (!c.created_at) return false;
                    const created = new Date(c.created_at);
                    return created.getMonth() === m.month && created.getFullYear() === m.year;
                }).length;
            });
            
            if (monthlyChart) monthlyChart.destroy();
            
            monthlyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: months.map(m => m.label),
                    datasets: [{
                        label: 'New Clients',
                        data: monthlyCounts,
                        backgroundColor: 'rgba(245, 158, 11, 0.8)',
                        borderColor: '#f59e0b',
                        borderWidth: 1,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: '#94a3b8', stepSize: 1 },
                            grid: { color: 'rgba(148, 163, 184, 0.1)' }
                        },
                        x: {
                            ticks: { color: '#94a3b8' },
                            grid: { display: false }
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }
        
        function generateRevenueBarChart() {
            const ctx = document.getElementById('revenueBarChart');
            if (!ctx) return;
            
            const countryRevenue = {};
            clients.forEach(c => {
                const country = c.country || 'Unknown';
                const revenue = Number(c.advance_payment || 0) + Number(c.full_payment || 0) +
                               (c.passport_submitted_by === 'agency' ? Number(c.passport_fee || 0) : 0);
                countryRevenue[country] = (countryRevenue[country] || 0) + revenue;
            });
            
            const sortedCountries = Object.entries(countryRevenue)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 8);
            
            const labels = sortedCountries.map(([k]) => k);
            const data = sortedCountries.map(([k, v]) => v);
            const colors = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899', '#06b6d4', '#84cc16'];
            
            if (revenueChart) revenueChart.destroy();
            
            revenueChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Revenue (â‚¹)',
                        data: data,
                        backgroundColor: colors.slice(0, labels.length).map(c => c + 'cc'),
                        borderColor: colors.slice(0, labels.length),
                        borderWidth: 1,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: { 
                                color: '#94a3b8',
                                callback: function(value) {
                                    return 'â‚¹' + value.toLocaleString();
                                }
                            },
                            grid: { color: 'rgba(148, 163, 184, 0.1)' }
                        },
                        y: {
                            ticks: { color: '#94a3b8' },
                            grid: { display: false }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'Revenue: â‚¹' + context.raw.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function generateCountryReportTable() {
            const table = document.getElementById('countryReportTable');
            if (!table) return;
            
            const countryData = {};
            clients.forEach(c => {
                const country = c.country || 'Unknown';
                if (!countryData[country]) {
                    countryData[country] = {
                        total: 0,
                        interviewPassed: 0,
                        visaApproved: 0,
                        readyToFly: 0,
                        revenue: 0
                    };
                }
                countryData[country].total++;
                if (c.interview_status === 'selected' || c.interview_status === 'passed') {
                    countryData[country].interviewPassed++;
                }
                if (c.visa_status === 'approved') {
                    countryData[country].visaApproved++;
                }
                if (c.visa_status === 'approved' && c.flying_date) {
                    countryData[country].readyToFly++;
                }
                countryData[country].revenue += Number(c.advance_payment || 0) + Number(c.full_payment || 0) +
                    (c.passport_submitted_by === 'agency' ? Number(c.passport_fee || 0) : 0);
            });
            
            if (Object.keys(countryData).length === 0) {
                table.innerHTML = '<tr><td colspan="7" style="text-align: center; color: var(--text-secondary); padding: 40px;">No data available</td></tr>';
                return;
            }
            
            const sortedCountries = Object.entries(countryData).sort((a, b) => b[1].total - a[1].total);
            
            table.innerHTML = sortedCountries.map(([country, data]) => {
                const successRate = data.total > 0 ? Math.round((data.visaApproved / data.total) * 100) : 0;
                const isGulf = ['Saudi Arabia', 'Dubai', 'UAE', 'Qatar', 'Kuwait', 'Bahrain', 'Oman'].includes(country);
                
                return `
                    <tr>
                        <td>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                ${country}
                                ${isGulf ? '<span style="color: #8b5cf6; font-size: 10px;">â—Gulf</span>' : ''}
                            </div>
                        </td>
                        <td><strong>${data.total}</strong></td>
                        <td><span class="status-badge status-success">${data.interviewPassed}</span></td>
                        <td><span class="status-badge status-success">${data.visaApproved}</span></td>
                        <td><span class="status-badge status-info">${data.readyToFly}</span></td>
                        <td><strong style="color: #10b981;">â‚¹${data.revenue.toLocaleString()}</strong></td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div style="flex: 1; height: 8px; background: var(--border); border-radius: 4px; overflow: hidden;">
                                    <div style="width: ${successRate}%; height: 100%; background: ${successRate >= 50 ? '#10b981' : successRate >= 25 ? '#f59e0b' : '#ef4444'};"></div>
                                </div>
                                <span style="font-size: 12px; color: var(--text-secondary);">${successRate}%</span>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        function exportReportPDF() {
            const reportContent = document.getElementById('reports');
            if (typeof html2pdf !== 'undefined') {
                const opt = {
                    margin: 10,
                    filename: `PGS_Report_${new Date().toISOString().split('T')[0]}.pdf`,
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { scale: 2, useCORS: true },
                    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
                };
                html2pdf().set(opt).from(reportContent).save();
                showToast('Report PDF downloaded!', 'success');
            } else {
                window.print();
                showToast('Print dialog opened!', 'success');
            }
        }

        // ==================== LOGIN/LOGOUT ====================
        
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                window.location.href = '/logout';
            }
        }
    </script>
    </div>
</body>
</html>
